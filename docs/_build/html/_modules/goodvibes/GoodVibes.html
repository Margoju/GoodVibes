

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>goodvibes.GoodVibes &mdash; GoodVibes 3.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> GoodVibes
          

          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ReadMe:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#quasi-harmonic-approximation">Quasi-Harmonic Approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#citing-goodvibes">Citing GoodVibes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-1-grimme-type-quasi-harmonic-correction-with-a-grimme-type-cut-off-of-150-cm-sup-1-sup">Example 1: Grimme-type quasi-harmonic correction with a (Grimme type) cut-off of 150 cm<sup>-1</sup></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-2-quasi-harmonic-thermochemistry-with-a-larger-basis-set-single-point-energy-correction-link-job">Example 2: Quasi-harmonic thermochemistry with a larger basis set single point energy correction link job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-3-changing-the-temperature-from-standard-298-15-k-to-1000-k-and-concentration-from-standard-state-in-gas-phase-1-atm-to-standard-state-in-solution-1-mol-l">Example 3: Changing the temperature (from standard 298.15 K to 1000 K) and concentration (from standard state in gas phase, 1 atm, to standard state in solution, 1 mol/l)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-4-analyzing-the-gibbs-energy-across-an-interval-of-temperatures-300-1000-k-with-a-stepsize-of-100-k-applying-a-truhlar-type-cut-off-of-100-cm-sup-1-sup">Example 4: Analyzing the Gibbs energy across an interval of temperatures 300-1000 K with a stepsize of 100 K, applying a (Truhlar type) cut-off of 100 cm<sup>-1</sup></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-5-analyzing-the-gibbs-energy-using-scaled-vibrational-frequencies">Example 5: Analyzing the Gibbs Energy using scaled vibrational frequencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-6-writing-cartesian-coordinates">Example 6: Writing Cartesian coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-7-analyzing-multiple-files-at-once">Example 7: Analyzing multiple files at once</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-8-entropic-symmetry-correction">Example 8: Entropic Symmetry Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-9-potential-energy-surface-pes-comparison-with-accessible-conformer-correction">Example 9: Potential Energy Surface (PES) Comparison with Accessible Conformer Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#example-10-stereoselectivity-and-boltzmann-populations">Example 10: Stereoselectivity and Boltzmann populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#checks">Checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#symmetry">Symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#file-naming-conventions">File Naming Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#yaml-file-formatting">.yaml File Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#papers-from-other-research-groups-citing-goodvibes">Papers from other research groups citing GoodVibes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/README.html#references-for-the-underlying-theory">References for the underlying theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/goodvibes.html">GoodVibes module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/goodvibes.html#module-goodvibes.media">goodvibes.media</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/goodvibes.html#module-goodvibes.vib_scale_factors">goodvibes.vib_scale_factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/goodvibes.html#module-goodvibes">Module contents</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GoodVibes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>goodvibes.GoodVibes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for goodvibes.GoodVibes</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*- </span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="sd">&quot;&quot;&quot;####################################################################</span>
<span class="sd">#                           GoodVibes.py                              #</span>
<span class="sd">#  Evaluation of quasi-harmonic thermochemistry from Gaussian.        #</span>
<span class="sd">#  Partion functions are evaluated from vibrational frequencies       #</span>
<span class="sd">#  and rotational temperatures from the standard output.              #</span>
<span class="sd">#######################################################################</span>
<span class="sd">#  The rigid-rotor harmonic oscillator approximation is used as       #</span>
<span class="sd">#  standard for all frequencies above a cut-off value. Below this,    #</span>
<span class="sd">#  two treatments can be applied to entropic values:                  #</span>
<span class="sd">#    (a) low frequencies are shifted to the cut-off value (as per     #</span>
<span class="sd">#    Cramer-Truhlar)                                                  #</span>
<span class="sd">#    (b) a free-rotor approximation is applied below the cut-off (as  #</span>
<span class="sd">#    per Grimme). In this approach, a damping function interpolates   #</span>
<span class="sd">#    between the RRHO and free-rotor entropy treatment of Svib to     #</span>
<span class="sd">#    avoid a discontinuity.                                           #</span>
<span class="sd">#  Both approaches avoid infinitely large values of Svib as wave-     #</span>
<span class="sd">#  numbers tend to zero. With a cut-off set to 0, the results will be #</span>
<span class="sd">#  identical to standard values output by the Gaussian program.       #</span>
<span class="sd">#######################################################################</span>
<span class="sd">#  Enthalpy values below the cutoff value are treated similarly to    #</span>
<span class="sd">#  Grimme&#39;s method (as per Head-Gordon) where below the cutoff value, #</span>
<span class="sd">#  a damping function is applied as the value approaches a value of   #</span>
<span class="sd">#  0.5RT, approprate for zeolitic systems                             #</span>
<span class="sd">#######################################################################</span>
<span class="sd">#  The free energy can be evaluated for variable temperature,         #</span>
<span class="sd">#  concentration, vibrational scaling factor, and with a haptic       #</span>
<span class="sd">#  correction of the translational entropy in different solvents,     #</span>
<span class="sd">#  according to the amount of free space available.                   #</span>
<span class="sd">#######################################################################</span>
<span class="sd">#  A potential energy surface may be evaluated for a given set of     #</span>
<span class="sd">#  structures or conformers, in which case a correction to the free-  #</span>
<span class="sd">#  energy due to multiple conformers is applied.                      #</span>
<span class="sd">#  Enantiomeric excess, diastereomeric ratios and ddG can also be     #</span>
<span class="sd">#  calculated to show preference of stereoisomers.                    #</span>
<span class="sd">#######################################################################</span>
<span class="sd">#  Careful checks may be applied to compare variables between         #</span>
<span class="sd">#  multiple files such as Gaussian version, solvation models, levels  #</span>
<span class="sd">#  of theory, charge and multiplicity, potential duplicate structures #</span>
<span class="sd">#  errors in potentail linear molecules, correct or incorrect         #</span>
<span class="sd">#  transition states, and empirical dispersion models.                #</span>
<span class="sd">#######################################################################</span>


<span class="sd">#######################################################################</span>
<span class="sd">###########  Authors:     Rob Paton, Ignacio Funes-Ardoiz  ############</span>
<span class="sd">###########               Guilian Luchini, Juan V. Alegre- ############</span>
<span class="sd">###########               Requena, Yanfei Guan             ############</span>
<span class="sd">###########  Last modified:  July, 2020                    ############</span>
<span class="sd">####################################################################&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">ctypes</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Importing regardless of relative import</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.vib_scale_factors</span> <span class="kn">import</span> <span class="n">scaling_data_dict</span><span class="p">,</span> <span class="n">scaling_data_dict_mod</span><span class="p">,</span> <span class="n">scaling_refs</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">vib_scale_factors</span> <span class="kn">import</span> <span class="n">scaling_data_dict</span><span class="p">,</span> <span class="n">scaling_data_dict_mod</span><span class="p">,</span> <span class="n">scaling_refs</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyDFTD3</span> <span class="kn">import</span> <span class="n">dftd3</span> <span class="k">as</span> <span class="n">D3</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">dftd3</span> <span class="kn">import</span> <span class="n">dftd3</span> <span class="k">as</span> <span class="n">D3</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="c1"># VERSION NUMBER</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;3.0.1&quot;</span>

<span class="n">SUPPORTED_EXTENSIONS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;.out&#39;</span><span class="p">,</span> <span class="s1">&#39;.log&#39;</span><span class="p">))</span>

<span class="c1"># PHYSICAL CONSTANTS                                      UNITS</span>
<span class="n">GAS_CONSTANT</span> <span class="o">=</span> <span class="mf">8.3144621</span>  <span class="c1"># J / K / mol</span>
<span class="n">PLANCK_CONSTANT</span> <span class="o">=</span> <span class="mf">6.62606957e-34</span>  <span class="c1"># J * s</span>
<span class="n">BOLTZMANN_CONSTANT</span> <span class="o">=</span> <span class="mf">1.3806488e-23</span>  <span class="c1"># J / K</span>
<span class="n">SPEED_OF_LIGHT</span> <span class="o">=</span> <span class="mf">2.99792458e10</span>  <span class="c1"># cm / s</span>
<span class="n">AVOGADRO_CONSTANT</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>  <span class="c1"># 1 / mol</span>
<span class="n">AMU_to_KG</span> <span class="o">=</span> <span class="mf">1.66053886E-27</span>  <span class="c1"># UNIT CONVERSION</span>
<span class="n">ATMOS</span> <span class="o">=</span> <span class="mf">101.325</span>  <span class="c1"># UNIT CONVERSION</span>
<span class="n">J_TO_AU</span> <span class="o">=</span> <span class="mf">4.184</span> <span class="o">*</span> <span class="mf">627.509541</span> <span class="o">*</span> <span class="mf">1000.0</span>  <span class="c1"># UNIT CONVERSION</span>
<span class="n">KCAL_TO_AU</span> <span class="o">=</span> <span class="mf">627.509541</span>  <span class="c1"># UNIT CONVERSION</span>

<span class="c1"># Some literature references</span>
<span class="n">grimme_ref</span> <span class="o">=</span> <span class="s2">&quot;Grimme, S. Chem. Eur. J. 2012, 18, 9955-9964&quot;</span>
<span class="n">truhlar_ref</span> <span class="o">=</span> <span class="s2">&quot;Ribeiro, R. F.; Marenich, A. V.; Cramer, C. J.; Truhlar, D. G. J. Phys. Chem. B 2011, 115, 14556-14562&quot;</span>
<span class="n">head_gordon_ref</span> <span class="o">=</span> <span class="s2">&quot;Li, Y.; Gomes, J.; Sharada, S. M.; Bell, A. T.; Head-Gordon, M. J. Phys. Chem. C 2015, 119, 1840-1850&quot;</span>
<span class="n">goodvibes_ref</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Luchini, G.; Alegre-Requena J. V.; Guan, Y.; Funes-Ardoiz, I.; Paton, R. S. (2019).&quot;</span>
                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        GoodVibes: GoodVibes &quot;</span> <span class="o">+</span> <span class="n">__version__</span> <span class="o">+</span> <span class="s2">&quot; http://doi.org/10.5281/zenodo.595246&quot;</span><span class="p">)</span>
<span class="n">csd_ref</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;C. R. Groom, I. J. Bruno, M. P. Lightfoot and S. C. Ward, Acta Cryst. 2016, B72, 171-179&quot;</span>
           <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Cordero, B.; Gomez V.; Platero-Prats, A. E.; Reves, M.; Echeverria, J.; Cremades, E.; Barragan, F.; Alvarez, S. Dalton Trans. 2008, 2832-2838&quot;</span><span class="p">)</span>
<span class="n">oniom_scale_ref</span> <span class="o">=</span> <span class="s2">&quot;Simon, L.; Paton, R. S. J. Am. Chem. Soc. 2018, 140, 5412-5420&quot;</span>
<span class="n">d3_ref</span> <span class="o">=</span> <span class="s2">&quot;Grimme, S.; Atony, J.; Ehrlich S.; Krieg, H. J. Chem. Phys. 2010, 132, 154104&quot;</span>
<span class="n">d3bj_ref</span> <span class="o">=</span> <span class="s2">&quot;Grimme S.; Ehrlich, S.; Goerigk, L. J. Comput. Chem. 2011, 32, 1456-1465&quot;</span>
<span class="n">atm_ref</span> <span class="o">=</span> <span class="s2">&quot;Axilrod, B. M.; Teller, E. J. Chem. Phys. 1943, 11, 299 </span><span class="se">\n</span><span class="s2"> Muto, Y. Proc. Phys. Math. Soc. Jpn. 1944, 17, 629&quot;</span>

<span class="c1"># Some useful arrays</span>
<span class="n">periodictable</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;He&quot;</span><span class="p">,</span> <span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="s2">&quot;Be&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;Ne&quot;</span><span class="p">,</span> <span class="s2">&quot;Na&quot;</span><span class="p">,</span> <span class="s2">&quot;Mg&quot;</span><span class="p">,</span> <span class="s2">&quot;Al&quot;</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Cl&quot;</span><span class="p">,</span> <span class="s2">&quot;Ar&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;Ca&quot;</span><span class="p">,</span> <span class="s2">&quot;Sc&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;Cr&quot;</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span><span class="p">,</span> <span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="s2">&quot;Co&quot;</span><span class="p">,</span> <span class="s2">&quot;Ni&quot;</span><span class="p">,</span> <span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="s2">&quot;Zn&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Ga&quot;</span><span class="p">,</span> <span class="s2">&quot;Ge&quot;</span><span class="p">,</span> <span class="s2">&quot;As&quot;</span><span class="p">,</span> <span class="s2">&quot;Se&quot;</span><span class="p">,</span> <span class="s2">&quot;Br&quot;</span><span class="p">,</span> <span class="s2">&quot;Kr&quot;</span><span class="p">,</span> <span class="s2">&quot;Rb&quot;</span><span class="p">,</span> <span class="s2">&quot;Sr&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Zr&quot;</span><span class="p">,</span> <span class="s2">&quot;Nb&quot;</span><span class="p">,</span> <span class="s2">&quot;Mo&quot;</span><span class="p">,</span> <span class="s2">&quot;Tc&quot;</span><span class="p">,</span> <span class="s2">&quot;Ru&quot;</span><span class="p">,</span> <span class="s2">&quot;Rh&quot;</span><span class="p">,</span> <span class="s2">&quot;Pd&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;Cd&quot;</span><span class="p">,</span> <span class="s2">&quot;In&quot;</span><span class="p">,</span> <span class="s2">&quot;Sn&quot;</span><span class="p">,</span> <span class="s2">&quot;Sb&quot;</span><span class="p">,</span> <span class="s2">&quot;Te&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Xe&quot;</span><span class="p">,</span> <span class="s2">&quot;Cs&quot;</span><span class="p">,</span> <span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;La&quot;</span><span class="p">,</span> <span class="s2">&quot;Ce&quot;</span><span class="p">,</span> <span class="s2">&quot;Pr&quot;</span><span class="p">,</span> <span class="s2">&quot;Nd&quot;</span><span class="p">,</span> <span class="s2">&quot;Pm&quot;</span><span class="p">,</span> <span class="s2">&quot;Sm&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Eu&quot;</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">,</span> <span class="s2">&quot;Tb&quot;</span><span class="p">,</span> <span class="s2">&quot;Dy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ho&quot;</span><span class="p">,</span> <span class="s2">&quot;Er&quot;</span><span class="p">,</span> <span class="s2">&quot;Tm&quot;</span><span class="p">,</span> <span class="s2">&quot;Yb&quot;</span><span class="p">,</span> <span class="s2">&quot;Lu&quot;</span><span class="p">,</span> <span class="s2">&quot;Hf&quot;</span><span class="p">,</span> <span class="s2">&quot;Ta&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;Re&quot;</span><span class="p">,</span> <span class="s2">&quot;Os&quot;</span><span class="p">,</span> <span class="s2">&quot;Ir&quot;</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Au&quot;</span><span class="p">,</span> <span class="s2">&quot;Hg&quot;</span><span class="p">,</span> <span class="s2">&quot;Tl&quot;</span><span class="p">,</span> <span class="s2">&quot;Pb&quot;</span><span class="p">,</span> <span class="s2">&quot;Bi&quot;</span><span class="p">,</span> <span class="s2">&quot;Po&quot;</span><span class="p">,</span> <span class="s2">&quot;At&quot;</span><span class="p">,</span> <span class="s2">&quot;Rn&quot;</span><span class="p">,</span> <span class="s2">&quot;Fr&quot;</span><span class="p">,</span> <span class="s2">&quot;Ra&quot;</span><span class="p">,</span> <span class="s2">&quot;Ac&quot;</span><span class="p">,</span> <span class="s2">&quot;Th&quot;</span><span class="p">,</span> <span class="s2">&quot;Pa&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;Np&quot;</span><span class="p">,</span> <span class="s2">&quot;Pu&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Am&quot;</span><span class="p">,</span> <span class="s2">&quot;Cm&quot;</span><span class="p">,</span> <span class="s2">&quot;Bk&quot;</span><span class="p">,</span> <span class="s2">&quot;Cf&quot;</span><span class="p">,</span> <span class="s2">&quot;Es&quot;</span><span class="p">,</span> <span class="s2">&quot;Fm&quot;</span><span class="p">,</span> <span class="s2">&quot;Md&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Lr&quot;</span><span class="p">,</span> <span class="s2">&quot;Rf&quot;</span><span class="p">,</span> <span class="s2">&quot;Db&quot;</span><span class="p">,</span> <span class="s2">&quot;Sg&quot;</span><span class="p">,</span> <span class="s2">&quot;Bh&quot;</span><span class="p">,</span> <span class="s2">&quot;Hs&quot;</span><span class="p">,</span> <span class="s2">&quot;Mt&quot;</span><span class="p">,</span> <span class="s2">&quot;Ds&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Rg&quot;</span><span class="p">,</span> <span class="s2">&quot;Uub&quot;</span><span class="p">,</span> <span class="s2">&quot;Uut&quot;</span><span class="p">,</span> <span class="s2">&quot;Uuq&quot;</span><span class="p">,</span> <span class="s2">&quot;Uup&quot;</span><span class="p">,</span> <span class="s2">&quot;Uuh&quot;</span><span class="p">,</span> <span class="s2">&quot;Uus&quot;</span><span class="p">,</span> <span class="s2">&quot;Uuo&quot;</span><span class="p">]</span>

<span class="c1"># Symmetry numbers for different point groups</span>
<span class="n">pg_sm</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Cs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Ci&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C4&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C5&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;C6&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;C7&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;C8&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;D2&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;D3&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
         <span class="s2">&quot;D4&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;D5&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;D6&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;D7&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;D8&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;C2v&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C3v&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C4v&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C5v&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;C6v&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;C7v&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
         <span class="s2">&quot;C8v&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;C2h&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C3h&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C4h&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C5h&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;C6h&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;C7h&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;C8h&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;D2h&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;D3h&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;D4h&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
         <span class="s2">&quot;D5h&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;D6h&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;D7h&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;D8h&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;D2d&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;D3d&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;D4d&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;D5d&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;D6d&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;D7d&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
         <span class="s2">&quot;D8d&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;S6&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;S8&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Th&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;Td&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;Oh&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;Cinfv&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Dinfh&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
         <span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Ih&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;Kh&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Radii used to determine connectivity in symmetry corrections</span>
<span class="c1"># Covalent radii taken from Cambridge Structural Database </span>
<span class="n">RADII</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mf">0.32</span><span class="p">,</span> <span class="s1">&#39;He&#39;</span><span class="p">:</span> <span class="mf">0.93</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">:</span> <span class="mf">1.23</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mf">0.82</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.77</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mf">0.73</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">0.72</span><span class="p">,</span>
         <span class="s1">&#39;Ne&#39;</span><span class="p">:</span> <span class="mf">0.71</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">:</span> <span class="mf">1.54</span><span class="p">,</span> <span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">1.36</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mf">1.11</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">1.06</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mf">1.02</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span> <span class="s1">&#39;Ar&#39;</span><span class="p">:</span> <span class="mf">0.98</span><span class="p">,</span>
         <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mf">2.03</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">:</span> <span class="mf">1.74</span><span class="p">,</span> <span class="s1">&#39;Sc&#39;</span><span class="p">:</span> <span class="mf">1.44</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">:</span> <span class="mf">1.32</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mf">1.22</span><span class="p">,</span> <span class="s1">&#39;Cr&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">1.17</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">:</span> <span class="mf">1.17</span><span class="p">,</span> <span class="s1">&#39;Co&#39;</span><span class="p">:</span> <span class="mf">1.16</span><span class="p">,</span>
         <span class="s1">&#39;Ni&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">:</span> <span class="mf">1.17</span><span class="p">,</span> <span class="s1">&#39;Zn&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span> <span class="s1">&#39;Ga&#39;</span><span class="p">:</span> <span class="mf">1.26</span><span class="p">,</span> <span class="s1">&#39;Ge&#39;</span><span class="p">:</span> <span class="mf">1.22</span><span class="p">,</span> <span class="s1">&#39;As&#39;</span><span class="p">:</span> <span class="mf">1.20</span><span class="p">,</span> <span class="s1">&#39;Se&#39;</span><span class="p">:</span> <span class="mf">1.16</span><span class="p">,</span> <span class="s1">&#39;Br&#39;</span><span class="p">:</span> <span class="mf">1.14</span><span class="p">,</span> <span class="s1">&#39;Kr&#39;</span><span class="p">:</span> <span class="mf">1.12</span><span class="p">,</span>
         <span class="s1">&#39;Rb&#39;</span><span class="p">:</span> <span class="mf">2.16</span><span class="p">,</span> <span class="s1">&#39;Sr&#39;</span><span class="p">:</span> <span class="mf">1.91</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mf">1.62</span><span class="p">,</span> <span class="s1">&#39;Zr&#39;</span><span class="p">:</span> <span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;Nb&#39;</span><span class="p">:</span> <span class="mf">1.34</span><span class="p">,</span> <span class="s1">&#39;Mo&#39;</span><span class="p">:</span> <span class="mf">1.30</span><span class="p">,</span> <span class="s1">&#39;Tc&#39;</span><span class="p">:</span> <span class="mf">1.27</span><span class="p">,</span> <span class="s1">&#39;Ru&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span> <span class="s1">&#39;Rh&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
         <span class="s1">&#39;Pd&#39;</span><span class="p">:</span> <span class="mf">1.28</span><span class="p">,</span> <span class="s1">&#39;Ag&#39;</span><span class="p">:</span> <span class="mf">1.34</span><span class="p">,</span> <span class="s1">&#39;Cd&#39;</span><span class="p">:</span> <span class="mf">1.48</span><span class="p">,</span> <span class="s1">&#39;In&#39;</span><span class="p">:</span> <span class="mf">1.44</span><span class="p">,</span> <span class="s1">&#39;Sn&#39;</span><span class="p">:</span> <span class="mf">1.41</span><span class="p">,</span> <span class="s1">&#39;Sb&#39;</span><span class="p">:</span> <span class="mf">1.40</span><span class="p">,</span> <span class="s1">&#39;Te&#39;</span><span class="p">:</span> <span class="mf">1.36</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mf">1.33</span><span class="p">,</span> <span class="s1">&#39;Xe&#39;</span><span class="p">:</span> <span class="mf">1.31</span><span class="p">,</span>
         <span class="s1">&#39;Cs&#39;</span><span class="p">:</span> <span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Ba&#39;</span><span class="p">:</span> <span class="mf">1.98</span><span class="p">,</span> <span class="s1">&#39;La&#39;</span><span class="p">:</span> <span class="mf">1.69</span><span class="p">,</span> <span class="s1">&#39;Lu&#39;</span><span class="p">:</span> <span class="mf">1.60</span><span class="p">,</span> <span class="s1">&#39;Hf&#39;</span><span class="p">:</span> <span class="mf">1.44</span><span class="p">,</span> <span class="s1">&#39;Ta&#39;</span><span class="p">:</span> <span class="mf">1.34</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mf">1.30</span><span class="p">,</span> <span class="s1">&#39;Re&#39;</span><span class="p">:</span> <span class="mf">1.28</span><span class="p">,</span> <span class="s1">&#39;Os&#39;</span><span class="p">:</span> <span class="mf">1.26</span><span class="p">,</span>
         <span class="s1">&#39;Ir&#39;</span><span class="p">:</span> <span class="mf">1.27</span><span class="p">,</span> <span class="s1">&#39;Pt&#39;</span><span class="p">:</span> <span class="mf">1.30</span><span class="p">,</span> <span class="s1">&#39;Au&#39;</span><span class="p">:</span> <span class="mf">1.34</span><span class="p">,</span> <span class="s1">&#39;Hg&#39;</span><span class="p">:</span> <span class="mf">1.49</span><span class="p">,</span> <span class="s1">&#39;Tl&#39;</span><span class="p">:</span> <span class="mf">1.48</span><span class="p">,</span> <span class="s1">&#39;Pb&#39;</span><span class="p">:</span> <span class="mf">1.47</span><span class="p">,</span> <span class="s1">&#39;Bi&#39;</span><span class="p">:</span> <span class="mf">1.46</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="c1"># Bondi van der Waals radii for all atoms from: Bondi, A. J. Phys. Chem. 1964, 68, 441-452, </span>
<span class="c1"># except hydrogen, which is taken from Rowland, R. S.; Taylor, R. J. Phys. Chem. 1996, 100, 7384-7391.</span>
<span class="c1"># Radii unavailable in either of these publications are set to 2 Angstrom</span>
<span class="c1"># (Unfinished)</span>
<span class="n">BONDI</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mf">1.09</span><span class="p">,</span> <span class="s1">&#39;He&#39;</span><span class="p">:</span> <span class="mf">1.40</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">:</span> <span class="mf">1.82</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">:</span> <span class="mf">2.00</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mf">2.00</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">1.70</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">1.55</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mf">1.52</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">1.47</span><span class="p">,</span>
         <span class="s1">&#39;Ne&#39;</span><span class="p">:</span> <span class="mf">1.54</span><span class="p">}</span>

<span class="n">alphabet</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>

<div class="viewcode-block" id="sharepath"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.sharepath">[docs]</a><span class="k">def</span> <span class="nf">sharepath</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get absolute pathway to GoodVibes project.</span>
<span class="sd">    </span>
<span class="sd">    Used in finding location of compiled C files used in symmetry corrections.</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    filename (str): name of compiled C file, OS specific.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    str: absolute path on machine to compiled C file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="element_id"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.element_id">[docs]</a><span class="k">def</span> <span class="nf">element_id</span><span class="p">(</span><span class="n">massno</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get element symbol from mass number.</span>
<span class="sd">    </span>
<span class="sd">    Used in parsing output files to determine elements present in file.</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    massno (int): mass of element.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    str: element symbol, or &#39;XX&#39; if not found in periodic table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">periodictable</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">massno</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">periodictable</span><span class="p">[</span><span class="n">massno</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;XX&quot;</span></div>


<div class="viewcode-block" id="all_same"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.all_same">[docs]</a><span class="k">def</span> <span class="nf">all_same</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns bool for checking if all items in a list are the same.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logger"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.Logger">[docs]</a><span class="k">class</span> <span class="nc">Logger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables output to terminal and to text file.</span>
<span class="sd">    </span>
<span class="sd">    Writes GV output to .dat or .csv files.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        csv (bool): decides if comma separated value file is written.</span>
<span class="sd">        log (file object): file to write GV output to.</span>
<span class="sd">        thermodata (bool): decides if string passed to logger is thermochemical data, needing to be separated by commas </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filein</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">csv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv</span> <span class="o">=</span> <span class="n">csv</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;dat&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filein</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">suffix</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Logger.write"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.Logger.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thermodata</span> <span class="o">=</span> <span class="n">thermodata</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">thermodata</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.fatal"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.Logger.fatal">[docs]</a>    <span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logger.finalize"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.Logger.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="c1"># Enables output of optimized coordinates to a single xyz-formatted file</span>
<div class="viewcode-block" id="xyz_out"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.xyz_out">[docs]</a><span class="k">class</span> <span class="nc">xyz_out</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables output of optimized coordinates to a single xyz-formatted file.</span>
<span class="sd">    </span>
<span class="sd">    Writes Cartesian coordinates of parsed chemical input.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        xyz (file object): path in current working directory to write Cartesian coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filein</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">append</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filein</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">suffix</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="xyz_out.write_text"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.xyz_out.write_text">[docs]</a>    <span class="k">def</span> <span class="nf">write_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="xyz_out.write_coords"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.xyz_out.write_coords">[docs]</a>    <span class="k">def</span> <span class="nf">write_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">carts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">cart</span> <span class="ow">in</span> <span class="n">carts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cart</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="xyz_out.finalize"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.xyz_out.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="calc_bbe"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_bbe">[docs]</a><span class="k">class</span> <span class="nc">calc_bbe</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function to compute the &quot;black box&quot; entropy and enthalpy values along with all other thermochemical quantities.</span>
<span class="sd">    </span>
<span class="sd">    Parses energy, program version, frequencies, charge, multiplicity, solvation model, computation time.</span>
<span class="sd">    Computes H, S from partition functions, applying qhasi-harmonic corrections, COSMO-RS solvation corrections,</span>
<span class="sd">    considering frequency scaling factors from detected level of theory/basis set, and optionally ONIOM frequency scaling.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        xyz (getoutData object): contains Cartesian coordinates, atom connectivity.</span>
<span class="sd">        job_type (str): contains information on the type of Gaussian job such as ground or transition state optimization, frequency.</span>
<span class="sd">        roconst (list): list of parsed rotational constants from Gaussian calculations.</span>
<span class="sd">        program (str): program used in chemical computation.</span>
<span class="sd">        version_program (str): program version used in chemical computation.</span>
<span class="sd">        solvation_model (str): solvation model used in chemical computation.</span>
<span class="sd">        file (str): input chemical computation output file.</span>
<span class="sd">        charge (int): overall charge of molecule.</span>
<span class="sd">        empirical_dispersion (str): empirical dispersion model used in computation.</span>
<span class="sd">        multiplicity (int): multiplicity of molecule or chemical system.</span>
<span class="sd">        mult (int): multiplicity of molecule or chemical system.</span>
<span class="sd">        point_group (str): point group of molecule or chemical system used for symmetry corrections.</span>
<span class="sd">        sp_energy (float): single-point energy parsed from output file. </span>
<span class="sd">        sp_program (str): program used for single-point energy calculation.</span>
<span class="sd">        sp_version_program (str): version of program used for single-point energy calculation.</span>
<span class="sd">        sp_solvation_model (str): solvation model used for single-point energy calculation.</span>
<span class="sd">        sp_file (str): single-point energy calculation output file.</span>
<span class="sd">        sp_charge (int): overall charge of molecule in single-point energy calculation.</span>
<span class="sd">        sp_empirical_dispersion (str): empirical dispersion model used in single-point energy computation.</span>
<span class="sd">        sp_multiplicity (int): multiplicity of molecule or chemical system in single-point energy computation.</span>
<span class="sd">        cpu (list): days, hours, mins, secs, msecs of computation time.</span>
<span class="sd">        scf_energy (float): self-consistent field energy.</span>
<span class="sd">        frequency_wn (list): frequencies parsed from chemical computation output file.</span>
<span class="sd">        im_freq (list): imaginary frequencies parsed from chemical computation output file.</span>
<span class="sd">        inverted_freqs (list): frequencies inverted from imaginary to real numbers.</span>
<span class="sd">        zero_point_corr (float): thermal corrections for zero-point energy parsed from file. </span>
<span class="sd">        zpe (float): vibrational zero point energy computed from frequencies. </span>
<span class="sd">        enthalpy (float): enthalpy computed from partition functions.</span>
<span class="sd">        qh_enthalpy (float): enthalpy computed from partition functions, quasi-harmonic corrections applied.</span>
<span class="sd">        entropy (float): entropy of chemical system computed from partition functions.</span>
<span class="sd">        qh_entropy (float): entropy of chemical system computed from partition functions, quasi-harmonic corrections applied.</span>
<span class="sd">        gibbs_free_energy (float): Gibbs free energy of chemical system computed from enthalpy and entropy.</span>
<span class="sd">        qh_gibbs_free_energy (float): Gibbs free energy of chemical system computed from quasi-harmonic enthalpy and/or entropy.</span>
<span class="sd">        cosmo_qhg (float): quasi-harmonic Gibbs free energy with COSMO-RS correction for Gibbs free energy of solvation </span>
<span class="sd">        linear_warning (bool): flag for linear molecules, may be missing a rotational constant. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">QS</span><span class="p">,</span> <span class="n">QH</span><span class="p">,</span> <span class="n">s_freq_cutoff</span><span class="p">,</span> <span class="n">H_FREQ_CUTOFF</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">conc</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">solv</span><span class="p">,</span> <span class="n">spc</span><span class="p">,</span>
                 <span class="n">invert</span><span class="p">,</span> <span class="n">d3_term</span><span class="p">,</span> <span class="n">ssymm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mm_freq_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inertia</span><span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
        <span class="c1"># List of frequencies and default values</span>
        <span class="n">im_freq_cutoff</span><span class="p">,</span> <span class="n">frequency_wn</span><span class="p">,</span> <span class="n">im_frequency_wn</span><span class="p">,</span> <span class="n">rotemp</span><span class="p">,</span> <span class="n">roconst</span><span class="p">,</span> <span class="n">linear_mol</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">freqloc</span><span class="p">,</span> <span class="n">linkmax</span><span class="p">,</span> <span class="n">symmno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">inverted_freqs</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span>
            <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[]</span>
        <span class="n">linear_warning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">fract_modelsys</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fract_modelsys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">mm_freq_scale_factor</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">=</span> <span class="n">jobtype</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roconst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Parse some useful information from the file </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvation_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empirical_dispersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">parse_data</span><span class="p">(</span>
            <span class="n">file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">g_output</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># Read any single point energies if requested</span>
        <span class="k">if</span> <span class="n">spc</span> <span class="o">!=</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">spc</span> <span class="o">!=</span> <span class="s1">&#39;link&#39;</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_version_program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_solvation_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_empirical_dispersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_multiplicity</span> <span class="o">=</span> <span class="n">parse_data</span><span class="p">(</span>
                    <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="n">sp_cpu</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">=</span> <span class="s1">&#39;!&#39;</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">spc</span> <span class="o">==</span> <span class="s1">&#39;link&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_version_program</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_solvation_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_empirical_dispersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_multiplicity</span> <span class="o">=</span> <span class="n">parse_data</span><span class="p">(</span>
                <span class="n">file</span><span class="p">)</span>
        <span class="c1"># Count number of links</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g_output</span><span class="p">:</span>
            <span class="c1"># Only read first link + freq not other link jobs</span>
            <span class="k">if</span> <span class="s2">&quot;Normal termination&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">linkmax</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frequency_wn</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;Frequencies --&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">freqloc</span> <span class="o">=</span> <span class="n">linkmax</span>

        <span class="c1"># Iterate over output</span>
        <span class="k">if</span> <span class="n">freqloc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">freqloc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_output</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">g_output</span><span class="p">):</span>
            <span class="c1"># Link counter</span>
            <span class="k">if</span> <span class="s2">&quot;Normal termination&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Reset frequencies if in final freq link</span>
                <span class="k">if</span> <span class="n">link</span> <span class="o">==</span> <span class="n">freqloc</span><span class="p">:</span>
                    <span class="n">frequency_wn</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">im_frequency_wn</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">fract_modelsys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># If spc specified will take last Energy from file, otherwise will break after freq calc</span>
            <span class="k">if</span> <span class="n">link</span> <span class="o">&gt;</span> <span class="n">freqloc</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c1"># Iterate over output: look out for low frequencies</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Frequencies -- &#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">newline</span> <span class="o">=</span> <span class="n">g_output</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">])</span>
                        <span class="c1"># If given MM freq scale factor fill the fract_modelsys array:</span>
                        <span class="k">if</span> <span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">newline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.0</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span>
                        <span class="c1"># Only deal with real frequencies</span>
                        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.00</span><span class="p">:</span>
                            <span class="n">frequency_wn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">fract_modelsys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                        <span class="c1"># Check if we want to make any low lying imaginary frequencies positive</span>
                        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">im_freq_cutoff</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">invert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">invert</span><span class="p">):</span>
                                    <span class="n">frequency_wn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                                    <span class="n">inverted_freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">im_frequency_wn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">im_frequency_wn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="c1"># For QM calculations look for SCF energies, last one will be the optimized energy</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SCF Done:&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="c1"># For Counterpoise calculations the corrected energy value will be taken</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Counterpoise corrected energy&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="c1"># For MP2 calculations replace with EUMP2</span>
            <span class="k">elif</span> <span class="s1">&#39;EUMP2 =&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">))</span>
            <span class="c1"># For ONIOM calculations use the extrapolated value rather than SCF value</span>
            <span class="k">elif</span> <span class="s2">&quot;ONIOM: extrapolated energy&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="c1"># For Semi-empirical or Molecular Mechanics calculations</span>
            <span class="k">elif</span> <span class="s2">&quot;Energy= &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Predicted&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Thermal&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># For TD-DFT calculations, replace with &#39;Total Energy&#39;</span>
            <span class="k">elif</span> <span class="s2">&quot;Total Energy, E(TD-HF/TD-DFT)&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="c1"># Look for thermal corrections, paying attention to point group symmetry</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Zero-point correction=&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zero_point_corr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c1"># Grab Multiplicity</span>
            <span class="k">elif</span> <span class="s1">&#39;Multiplicity&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mult</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mult</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Grab molecular mass</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Molecular mass:&#39;</span><span class="p">):</span>
                <span class="n">molecular_mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c1"># Grab rational symmetry number</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Rotational symmetry number&#39;</span><span class="p">):</span>
                <span class="n">symmno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># Grab point group</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Full point group&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;D*H&#39;</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;C*V&#39;</span><span class="p">:</span>
                    <span class="n">linear_mol</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># Grab rotational constants</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Rotational constants (GHZ):&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roconst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;********&#39;</span><span class="p">):</span>
                        <span class="n">linear_warning</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">roconst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span>
                                        <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])]</span>
            <span class="c1"># Grab rotational temperatures</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Rotational temperature &#39;</span><span class="p">):</span>
                <span class="n">rotemp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])]</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Rotational temperatures&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rotemp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span>
                              <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">rotemp</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;********&#39;</span><span class="p">):</span>
                        <span class="n">linear_warning</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">rotemp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])]</span>
            <span class="k">if</span> <span class="s2">&quot;Job cpu time&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">mins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">secs</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msecs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="p">[</span><span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">msecs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inverted_freqs</span> <span class="o">=</span> <span class="n">inverted_freqs</span>
        <span class="c1"># Skip the calculation if unable to parse the frequencies or zpe from the output file</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;zero_point_corr&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rotemp</span><span class="p">:</span>
            <span class="n">cutoffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s_freq_cutoff</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>

            <span class="c1"># Translational and electronic contributions to the energy and entropy do not depend on frequencies</span>
            <span class="n">u_trans</span> <span class="o">=</span> <span class="n">calc_translational_energy</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
            <span class="n">s_trans</span> <span class="o">=</span> <span class="n">calc_translational_entropy</span><span class="p">(</span><span class="n">molecular_mass</span><span class="p">,</span> <span class="n">conc</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">solv</span><span class="p">)</span>
            <span class="n">s_elec</span> <span class="o">=</span> <span class="n">calc_electronic_entropy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mult</span><span class="p">)</span>

            <span class="c1"># Rotational and Vibrational contributions to the energy entropy</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zpe</span> <span class="o">=</span> <span class="n">calc_zeropoint_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">)</span>
                <span class="n">u_rot</span> <span class="o">=</span> <span class="n">calc_rotational_energy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_point_corr</span><span class="p">,</span> <span class="n">symmno</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">linear_mol</span><span class="p">)</span>
                <span class="n">u_vib</span> <span class="o">=</span> <span class="n">calc_vibrational_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">)</span>
                <span class="n">s_rot</span> <span class="o">=</span> <span class="n">calc_rotational_entropy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_point_corr</span><span class="p">,</span> <span class="n">linear_mol</span><span class="p">,</span> <span class="n">symmno</span><span class="p">,</span> <span class="n">rotemp</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>

                <span class="c1"># Calculate harmonic entropy, free-rotor entropy and damping function for each frequency</span>
                <span class="n">Svib_rrho</span> <span class="o">=</span> <span class="n">calc_rrho_entropy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">s_freq_cutoff</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">Svib_rrqho</span> <span class="o">=</span> <span class="n">calc_rrho_entropy</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">)</span>
                <span class="n">Svib_free_rot</span> <span class="o">=</span> <span class="n">calc_freerot_entropy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">,</span><span class="n">file</span><span class="p">,</span> <span class="n">inertia</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roconst</span><span class="p">)</span>
                <span class="n">S_damp</span> <span class="o">=</span> <span class="n">calc_damp</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">s_freq_cutoff</span><span class="p">)</span>

                <span class="c1"># check for qh</span>
                <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                    <span class="n">Uvib_qrrho</span> <span class="o">=</span> <span class="n">calc_qRRHO_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">)</span>
                    <span class="n">H_damp</span> <span class="o">=</span> <span class="n">calc_damp</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">H_FREQ_CUTOFF</span><span class="p">)</span>

                <span class="c1"># Compute entropy (cal/mol/K) using the two values and damping function</span>
                <span class="n">vib_entropy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vib_energy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">)):</span>
                    <span class="c1"># Entropy correction</span>
                    <span class="k">if</span> <span class="n">QS</span> <span class="o">==</span> <span class="s2">&quot;grimme&quot;</span><span class="p">:</span>
                        <span class="n">vib_entropy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Svib_rrho</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">S_damp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">S_damp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">Svib_free_rot</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">QS</span> <span class="o">==</span> <span class="s2">&quot;truhlar&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s_freq_cutoff</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">frequency_wn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">s_freq_cutoff</span><span class="p">:</span>
                                <span class="n">vib_entropy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Svib_rrho</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">vib_entropy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Svib_rrqho</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">vib_entropy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Svib_rrho</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="c1"># Enthalpy correction</span>
                    <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                        <span class="n">vib_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H_damp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Uvib_qrrho</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">H_damp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span>

                <span class="n">qh_s_vib</span><span class="p">,</span> <span class="n">h_s_vib</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vib_entropy</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Svib_rrho</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                    <span class="n">qh_u_vib</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vib_energy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zpe</span><span class="p">,</span> <span class="n">u_rot</span><span class="p">,</span> <span class="n">u_vib</span><span class="p">,</span> <span class="n">qh_u_vib</span><span class="p">,</span> <span class="n">s_rot</span><span class="p">,</span> <span class="n">h_s_vib</span><span class="p">,</span> <span class="n">qh_s_vib</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

            <span class="c1"># The D3 term is added to the energy term here. If not requested then this term is zero</span>
            <span class="c1"># It is added to the SPC energy if defined (instead of the SCF energy)</span>
            <span class="k">if</span> <span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">+=</span> <span class="n">d3_term</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">+=</span> <span class="n">d3_term</span>

            <span class="c1"># Add terms (converted to au) to get Free energy - perform separately</span>
            <span class="c1"># for harmonic and quasi-harmonic values out of interest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">+</span> <span class="p">(</span><span class="n">u_trans</span> <span class="o">+</span> <span class="n">u_rot</span> <span class="o">+</span> <span class="n">u_vib</span> <span class="o">+</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">J_TO_AU</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">+</span> <span class="p">(</span><span class="n">u_trans</span> <span class="o">+</span> <span class="n">u_rot</span> <span class="o">+</span> <span class="n">qh_u_vib</span> <span class="o">+</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">J_TO_AU</span>
            <span class="c1"># Single point correction replaces energy from optimization with single point value</span>
            <span class="k">if</span> <span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_energy</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">zpe</span> <span class="o">=</span> <span class="n">zpe</span> <span class="o">/</span> <span class="n">J_TO_AU</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_trans</span> <span class="o">+</span> <span class="n">s_rot</span> <span class="o">+</span> <span class="n">h_s_vib</span> <span class="o">+</span> <span class="n">s_elec</span><span class="p">)</span> <span class="o">/</span> <span class="n">J_TO_AU</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_trans</span> <span class="o">+</span> <span class="n">s_rot</span> <span class="o">+</span> <span class="n">qh_s_vib</span> <span class="o">+</span> <span class="n">s_elec</span><span class="p">)</span> <span class="o">/</span> <span class="n">J_TO_AU</span>

            <span class="c1"># Symmetry - entropy correction for molecular symmetry</span>
            <span class="k">if</span> <span class="n">ssymm</span><span class="p">:</span>
                <span class="n">sym_entropy_correction</span><span class="p">,</span> <span class="n">pgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_correction</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">point_group</span> <span class="o">=</span> <span class="n">pgroup</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span> <span class="o">+=</span> <span class="n">sym_entropy_correction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">+=</span> <span class="n">sym_entropy_correction</span>

            <span class="c1"># Calculate Free Energy</span>
            <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gibbs_free_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_entropy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gibbs_free_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_entropy</span>

            <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">+</span> <span class="n">cosmo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_freq</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">im_frequency_wn</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">freq</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">im_freq_cutoff</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">im_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_wn</span> <span class="o">=</span> <span class="n">frequency_wn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im_frequency_wn</span> <span class="o">=</span> <span class="n">im_frequency_wn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_warning</span> <span class="o">=</span> <span class="n">linear_warning</span>

    <span class="c1"># Get external symmetry number</span>
<div class="viewcode-block" id="calc_bbe.ex_sym"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_bbe.ex_sym">[docs]</a>    <span class="k">def</span> <span class="nf">ex_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="n">coords_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">coords_string</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coords_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">c_coords</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="c1"># Determine OS with sys.platform to see what compiled symmetry file to use</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>  <span class="c1"># linux - .so file</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="s1">&#39;symmetry_linux.so&#39;</span><span class="p">)</span>
            <span class="n">newlib</span> <span class="o">=</span> <span class="s1">&#39;lib_&#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.so&#39;</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="n">newlib</span><span class="p">)</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="s1">&#39;cp &#39;</span> <span class="o">+</span> <span class="n">path1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">path2</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>  <span class="c1"># macOS - .dylib file</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="s1">&#39;symmetry_mac.dylib&#39;</span><span class="p">)</span>
            <span class="n">newlib</span> <span class="o">=</span> <span class="s1">&#39;lib_&#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.dylib&#39;</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="n">newlib</span><span class="p">)</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="s1">&#39;cp &#39;</span> <span class="o">+</span> <span class="n">path1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">path2</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>  <span class="c1"># windows - .dll file</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="s1">&#39;symmetry_windows.dll&#39;</span><span class="p">)</span>
            <span class="n">newlib</span> <span class="o">=</span> <span class="s1">&#39;lib_&#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.dll&#39;</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">sharepath</span><span class="p">(</span><span class="n">newlib</span><span class="p">)</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="s1">&#39;copy &#39;</span> <span class="o">+</span> <span class="n">path1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">path2</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cdll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span>

        <span class="n">symmetry</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span>
        <span class="n">pgroup</span> <span class="o">=</span> <span class="n">symmetry</span><span class="o">.</span><span class="n">symmetry</span><span class="p">(</span><span class="n">c_coords</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">ex_sym</span> <span class="o">=</span> <span class="n">pg_sm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pgroup</span><span class="p">)</span>

        <span class="c1"># Remove file</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>  <span class="c1"># linux - .so file</span>
            <span class="n">remove</span> <span class="o">=</span> <span class="s1">&#39;rm &#39;</span> <span class="o">+</span> <span class="n">path2</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">remove</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>  <span class="c1"># macOS - .dylib file</span>
            <span class="n">remove</span> <span class="o">=</span> <span class="s1">&#39;rm &#39;</span> <span class="o">+</span> <span class="n">path2</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">remove</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>  <span class="c1"># windows - .dll file</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">symmetry</span><span class="o">.</span><span class="n">_handle</span>
            <span class="k">del</span> <span class="n">symmetry</span>
            <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">FreeLibrary</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(</span><span class="n">handle</span><span class="p">))</span>
            <span class="n">remove</span> <span class="o">=</span> <span class="s1">&#39;Del /F &quot;&#39;</span> <span class="o">+</span> <span class="n">path2</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">remove</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ex_sym</span><span class="p">,</span> <span class="n">pgroup</span></div>

<div class="viewcode-block" id="calc_bbe.int_sym"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_bbe.int_sym">[docs]</a>    <span class="k">def</span> <span class="nf">int_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">()</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
        <span class="n">neighbor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
        <span class="n">int_sym</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">connectivity</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">As</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">)[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">As</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">As</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neighbor</span><span class="p">]</span>
                <span class="n">caps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">As</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cap</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">caps</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">int_sym</span> <span class="o">*=</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">int_sym</span></div>

<div class="viewcode-block" id="calc_bbe.sym_correction"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_bbe.sym_correction">[docs]</a>    <span class="k">def</span> <span class="nf">sym_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="n">ex_sym</span><span class="p">,</span> <span class="n">pgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ex_sym</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">int_sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_sym</span><span class="p">()</span>
        <span class="c1">#override int_sym</span>
        <span class="n">int_sym</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">sym_num</span> <span class="o">=</span> <span class="n">ex_sym</span> <span class="o">*</span> <span class="n">int_sym</span>
        <span class="n">sym_correction</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sym_num</span><span class="p">))</span> <span class="o">/</span> <span class="n">J_TO_AU</span>
        <span class="k">return</span> <span class="n">sym_correction</span><span class="p">,</span> <span class="n">pgroup</span></div></div>


<div class="viewcode-block" id="get_pes"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.get_pes">[docs]</a><span class="k">class</span> <span class="nc">get_pes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain relative thermochemistry between species and for reactions.</span>
<span class="sd">    </span>
<span class="sd">    Routine that computes Boltzmann populations of conformer sets at each step of a reaction, obtaining</span>
<span class="sd">    relative energetic and thermodynamic values for each step in a reaction pathway.</span>
<span class="sd">    Determines reaction pathway from .yaml formatted file containing definitions for where files fit in pathway.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        dec (int): decimal places to display after PES calculations.</span>
<span class="sd">        units (str): units do display values in, choice of kcal/mol or kJ/mol.</span>
<span class="sd">        boltz (str): allows for selectivity calculation to display to user.</span>
<span class="sd">        path (list): list of strings defining each reaction pathway.</span>
<span class="sd">        species (list): list of strings defining which files correspond to names given in reaction pathway.</span>
<span class="sd">        spc_abs (list): list of relative single-point energy values.</span>
<span class="sd">        e_abs (list): list of relative energy values.</span>
<span class="sd">        zpe_abs (list): list of relative zero point energy values.</span>
<span class="sd">        h_abs (list): list of relative enthalpy values.</span>
<span class="sd">        qh_abs (list): list of relative quasi-harmonic enthalpy values.</span>
<span class="sd">        s_abs (list): list of relative entropy values.</span>
<span class="sd">        qs_abs (list): list of relative quasi-harmonic entropy values.</span>
<span class="sd">        g_abs (list): list of relative Gibbs free energy values.</span>
<span class="sd">        qhg_abs (list): list of relative quasi-harmonic Gibbs free energy values.</span>
<span class="sd">        cosmo_qhg_abs (list): list of relative COSMO-RS solvation-corrected quasi-harmonic Gibbs free energy values.</span>
<span class="sd">        spc_zero (list): list of single point energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        e_zero (list): list of energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        zpe_zero (list): list of zero point energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        h_zero (list): list of enthalpy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        qh_zero (list): list of quasi-harmonic enthalpy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        ts_zero (list): list of T*entropy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        qhts_zero (list): list of quasi-harmonic T*entropy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        g_zero (list): list of Gibbs free energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        qhg_zero (list): list of quasi-harmonic Gibbs free energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        cosmo_qhg_zero (list): list of COSMO-RS solvation-corrected quasi-harmonic Gibbs free energy &quot;zero&quot; species values to compare all other steps in pathway to.</span>
<span class="sd">        g_qhgvals (list): relative quasi-harmonic Gibbs free energy values used for graphing.</span>
<span class="sd">        g_species_qhgzero (list):quasi-harmonic Gibbs free energy &quot;zero&quot; values used for graphing.</span>
<span class="sd">        g_rel_val (list): relative Gibbs free energy values used for graphing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">gconf</span><span class="p">,</span> <span class="n">QH</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cosmo_int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Default values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boltz</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;kcal/mol&#39;</span><span class="p">,</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">pes_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;PES&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">pathway</span><span class="p">,</span> <span class="n">pes</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                        <span class="c1"># Auto-grab first species as zero unless specified</span>
                        <span class="n">pes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="p">)</span>
                        <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># Look at SPECIES block to determine filenames </span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;SPECIES&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">folder</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">n</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))</span>
                                <span class="c1"># Check the specified filename is also one that GoodVibes has thermochemistry for:</span>
                                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pes_list</span><span class="p">:</span>
                                    <span class="n">match</span> <span class="o">=</span> <span class="kc">None</span>
                                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">key</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                                            <span class="n">match</span> <span class="o">=</span> <span class="n">key</span>
                                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                                        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Warning! &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; is specified in &#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> 
                                                  <span class="s1">&#39; but no thermochemistry data found</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pes_list</span><span class="p">:</span>
                                    <span class="n">match</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">key</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Warning! &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; is specified in &#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> 
                                                  <span class="s1">&#39; but no thermochemistry data found</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                                    <span class="k">pass</span>
                                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="k">pass</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">warn</span> <span class="o">=</span> <span class="s2">&quot;   Warning! &quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39; input is incorrectly formatted for line:</span><span class="se">\n\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">line</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span>
            <span class="c1"># Look at FORMAT block to see if user has specified any formatting rules</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;FORMAT&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;boltz&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">boltz</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_species_qhgzero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_rel_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="c1"># Loop over .yaml file, grab energies, populate arrays and compute Boltzmann factors</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;PES&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">e_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">spc_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">zpe_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">h_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qh_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ts_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qhts_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">g_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qhg_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">min_conf</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">spc_zero</span><span class="p">,</span> <span class="n">e_zero</span><span class="p">,</span> <span class="n">zpe_zero</span><span class="p">,</span> <span class="n">h_zero</span><span class="p">,</span> <span class="n">qh_zero</span><span class="p">,</span> <span class="n">s_zero</span><span class="p">,</span> <span class="n">qs_zero</span><span class="p">,</span> <span class="n">g_zero</span><span class="p">,</span> <span class="n">qhg_zero</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                            <span class="n">h_conf</span><span class="p">,</span> <span class="n">h_tot</span><span class="p">,</span> <span class="n">s_conf</span><span class="p">,</span> <span class="n">s_tot</span><span class="p">,</span> <span class="n">qh_conf</span><span class="p">,</span> <span class="n">qh_tot</span><span class="p">,</span> <span class="n">qs_conf</span><span class="p">,</span> <span class="n">qs_tot</span><span class="p">,</span> <span class="n">cosmo_qhg_zero</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                            <span class="n">zero_structures</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                            <span class="c1"># Routine for &#39;zero&#39; values</span>
                            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">zero_structures</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">):</span>
                                            <span class="n">spc_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">sp_energy</span>
                                        <span class="n">e_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">scf_energy</span>
                                        <span class="n">zpe_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">zpe</span>
                                        <span class="n">h_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">enthalpy</span>
                                        <span class="n">qh_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                        <span class="n">s_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">entropy</span>
                                        <span class="n">qs_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_entropy</span>
                                        <span class="n">g_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">gibbs_free_energy</span>
                                        <span class="n">qhg_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                        <span class="n">cosmo_qhg_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">cosmo_qhg</span>
                                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># If we have a list of different kinds of structures: loop over conformers</span>
                                        <span class="n">g_min</span><span class="p">,</span> <span class="n">boltz_sum</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mf">0.0</span>
                                        <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span>
                                            <span class="n">structure</span><span class="p">]:</span>  <span class="c1"># Find minimum G, along with associated enthalpy and entropy</span>
                                            <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                <span class="k">if</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">&lt;=</span> <span class="n">g_min</span><span class="p">:</span>
                                                    <span class="n">min_conf</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span>
                                                    <span class="n">g_min</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="k">if</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">&lt;=</span> <span class="n">g_min</span><span class="p">:</span>
                                                    <span class="n">min_conf</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span>
                                                    <span class="n">g_min</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                        <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]:</span>  <span class="c1"># Get a Boltzmann sum for conformers</span>
                                            <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">-</span> <span class="n">g_min</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">-</span> <span class="n">g_min</span>
                                            <span class="n">boltz_fac</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_rel</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                                            <span class="n">boltz_sum</span> <span class="o">+=</span> <span class="n">boltz_fac</span>
                                        <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span>
                                            <span class="n">structure</span><span class="p">]:</span>  <span class="c1"># Calculate relative data based on Gmin and the Boltzmann sum</span>
                                            <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">-</span> <span class="n">g_min</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">-</span> <span class="n">g_min</span>
                                            <span class="n">boltz_fac</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_rel</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                                            <span class="n">boltz_prob</span> <span class="o">=</span> <span class="n">boltz_fac</span> <span class="o">/</span> <span class="n">boltz_sum</span>
                                            <span class="c1">#if no contribution, skip further calculations</span>
                                            <span class="k">if</span> <span class="n">boltz_prob</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                                                <span class="k">continue</span>
                                                
                                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                                <span class="n">spc_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="ow">is</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                                                    <span class="s2">&quot;Not all files contain a SPC value, relative values will not be calculated.&quot;</span><span class="p">)</span>
                                            <span class="n">e_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                            <span class="n">zpe_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">zpe</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                            <span class="c1"># Default calculate gconf correction for conformers, skip if no contribution</span>
                                            <span class="k">if</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>  
                                                <span class="n">h_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">s_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">s_conf</span> <span class="o">+=</span> <span class="o">-</span><span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">J_TO_AU</span> <span class="o">*</span> <span class="n">boltz_prob</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">boltz_prob</span><span class="p">)</span>

                                                <span class="n">qh_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">qs_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">qs_conf</span> <span class="o">+=</span> <span class="o">-</span><span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">J_TO_AU</span> <span class="o">*</span> <span class="n">boltz_prob</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">boltz_prob</span><span class="p">)</span>
                                            <span class="k">elif</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                                                <span class="n">h_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span>
                                                <span class="n">s_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span>
                                                <span class="n">qh_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                                <span class="n">qs_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">h_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">s_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">g_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>

                                                <span class="n">qh_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">qs_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">qhg_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                <span class="n">cosmo_qhg_zero</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">*</span> <span class="n">boltz_prob</span>

                                        <span class="k">if</span> <span class="n">gconf</span><span class="p">:</span>
                                            <span class="n">h_adj</span> <span class="o">=</span> <span class="n">h_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">enthalpy</span>
                                            <span class="n">h_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">+</span> <span class="n">h_adj</span>
                                            <span class="n">s_adj</span> <span class="o">=</span> <span class="n">s_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">entropy</span>
                                            <span class="n">s_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">entropy</span> <span class="o">+</span> <span class="n">s_adj</span>
                                            <span class="n">g_corr</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">s_tot</span>
                                            <span class="n">qh_adj</span> <span class="o">=</span> <span class="n">qh_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                            <span class="n">qh_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">+</span> <span class="n">qh_adj</span>
                                            <span class="n">qs_adj</span> <span class="o">=</span> <span class="n">qs_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_entropy</span>
                                            <span class="n">qs_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">+</span> <span class="n">qs_adj</span>
                                            <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                                                <span class="n">qg_corr</span> <span class="o">=</span> <span class="n">qh_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">qs_tot</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">qg_corr</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">qs_tot</span>
                                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="s2">&quot;   Warning! Structure &quot;</span> <span class="o">+</span> <span class="n">structure</span> <span class="o">+</span> <span class="s1">&#39; has not been defined correctly as energy-zero in &#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="s2">&quot;   Make sure this structure matches one of the SPECIES defined in the same file</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;   Please edit &quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s2">&quot; and try again</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Set zero vals here</span>
                            <span class="n">conformers</span><span class="p">,</span> <span class="n">single_structure</span><span class="p">,</span> <span class="n">mix</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">zero_structures</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                                    <span class="n">single_structure</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">conformers</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">conformers</span> <span class="ow">and</span> <span class="n">single_structure</span><span class="p">:</span>
                                <span class="n">mix</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">min_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">mix</span><span class="p">:</span>
                                    <span class="n">h_mix</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">+</span> <span class="n">h_zero</span>
                                    <span class="n">s_mix</span> <span class="o">=</span> <span class="n">s_tot</span> <span class="o">+</span> <span class="n">s_zero</span>
                                    <span class="n">g_mix</span> <span class="o">=</span> <span class="n">g_corr</span> <span class="o">+</span> <span class="n">g_zero</span>
                                    <span class="n">qh_mix</span> <span class="o">=</span> <span class="n">qh_tot</span> <span class="o">+</span> <span class="n">qh_zero</span>
                                    <span class="n">qs_mix</span> <span class="o">=</span> <span class="n">qs_tot</span> <span class="o">+</span> <span class="n">qs_zero</span>
                                    <span class="n">qg_mix</span> <span class="o">=</span> <span class="n">qg_corr</span> <span class="o">+</span> <span class="n">qhg_zero</span>
                                    <span class="n">cosmo_qhg_mix</span> <span class="o">=</span> <span class="n">qg_corr</span> <span class="o">+</span> <span class="n">cosmo_qhg_zero</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_mix</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cosmo_qhg_mix</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">conformers</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_tot</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tot</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_corr</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_tot</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_tot</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_corr</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_corr</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_zero</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_zero</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_zero</span><span class="p">)</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_zero</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_zero</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qhg_zero</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cosmo_qhg_zero</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spc_zero</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">e_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_zero</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zpe_zero</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">e_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">spc_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">zpe_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">h_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qh_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">s_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">g_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qs_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">qhg_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">g_species_qhgzero</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">g_rel_val</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>  <span class="c1"># graphing</span>

                            <span class="n">pathway</span><span class="p">,</span> <span class="n">pes</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                            <span class="n">pes</span> <span class="o">=</span> <span class="n">pes</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">pes</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                            <span class="c1"># Obtain relative values for each species</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">point</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                    <span class="c1"># Create values to populate</span>
                                    <span class="n">point_structures</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                                    <span class="n">e_abs</span><span class="p">,</span> <span class="n">spc_abs</span><span class="p">,</span> <span class="n">zpe_abs</span><span class="p">,</span> <span class="n">h_abs</span><span class="p">,</span> <span class="n">qh_abs</span><span class="p">,</span> <span class="n">s_abs</span><span class="p">,</span> <span class="n">g_abs</span><span class="p">,</span> <span class="n">qs_abs</span><span class="p">,</span> <span class="n">qhg_abs</span><span class="p">,</span> <span class="n">cosmo_qhg_abs</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                                    <span class="n">qh_conf</span><span class="p">,</span> <span class="n">qh_tot</span><span class="p">,</span> <span class="n">qs_conf</span><span class="p">,</span> <span class="n">qs_tot</span><span class="p">,</span> <span class="n">h_conf</span><span class="p">,</span> <span class="n">h_tot</span><span class="p">,</span> <span class="n">s_conf</span><span class="p">,</span> <span class="n">s_tot</span><span class="p">,</span> <span class="n">g_corr</span><span class="p">,</span> <span class="n">qg_corr</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                                    <span class="n">min_conf</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="n">rel_val</span> <span class="o">=</span> <span class="mf">0.0</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">g_species_qhgzero</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">structure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_structures</span><span class="p">):</span>  <span class="c1"># Loop over structures, structures are species specified</span>
                                            <span class="n">zero_conf</span> <span class="o">=</span> <span class="mf">0.0</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># Only one conf in structures</span>
                                                <span class="n">e_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">scf_energy</span>
                                                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">):</span>
                                                    <span class="n">spc_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">sp_energy</span>
                                                <span class="n">zpe_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">zpe</span>
                                                <span class="n">h_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">enthalpy</span>
                                                <span class="n">qh_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                                <span class="n">s_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">entropy</span>
                                                <span class="n">g_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">gibbs_free_energy</span>
                                                <span class="n">qs_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_entropy</span>
                                                <span class="n">qhg_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                                <span class="n">cosmo_qhg_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">cosmo_qhg</span>
                                                <span class="n">zero_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                    <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">)</span>
                                                <span class="n">rel_val</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># If we have a list of different kinds of structures: loop over conformers</span>
                                                <span class="n">g_min</span><span class="p">,</span> <span class="n">boltz_sum</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mf">0.0</span>
                                                <span class="c1"># Find minimum G, along with associated enthalpy and entropy</span>
                                                <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]:</span>
                                                    <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                        <span class="k">if</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">&lt;=</span> <span class="n">g_min</span><span class="p">:</span>
                                                            <span class="n">min_conf</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span>
                                                            <span class="n">g_min</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="k">if</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">&lt;=</span> <span class="n">g_min</span><span class="p">:</span>
                                                            <span class="n">min_conf</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span>
                                                            <span class="n">g_min</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                                                <span class="c1"># Get a Boltzmann sum for conformers</span>
                                                <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]:</span>
                                                    <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                        <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">-</span> <span class="n">g_min</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">-</span> <span class="n">g_min</span>
                                                    <span class="n">boltz_fac</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_rel</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                                                    <span class="n">boltz_sum</span> <span class="o">+=</span> <span class="n">boltz_fac</span>
                                                <span class="c1"># Calculate relative data based on Gmin and the Boltzmann sum</span>
                                                <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">]:</span>
                                                    <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                        <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">-</span> <span class="n">g_min</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="n">g_rel</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">-</span> <span class="n">g_min</span>
                                                    <span class="n">boltz_fac</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_rel</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                                                    <span class="n">boltz_prob</span> <span class="o">=</span> <span class="n">boltz_fac</span> <span class="o">/</span> <span class="n">boltz_sum</span>
                                                    <span class="k">if</span> <span class="n">boltz_prob</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                                                        <span class="k">continue</span>
                                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                        <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                                        <span class="n">spc_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">sp_energy</span> <span class="ow">is</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Not all files contain a SPC value, relative values will not be calculated.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                                    <span class="n">e_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="n">zpe_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">zpe</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                        <span class="n">zero_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">rel_val</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="n">zero_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                                         <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">rel_val</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                                       <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="c1"># Default calculate gconf correction for conformers, skip if no contribution</span>
                                                    <span class="k">if</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>    
                                                        <span class="n">h_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">s_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">s_conf</span> <span class="o">+=</span> <span class="o">-</span><span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">J_TO_AU</span> <span class="o">*</span> <span class="n">boltz_prob</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">boltz_prob</span><span class="p">)</span>

                                                        <span class="n">qh_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">qs_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">qs_conf</span> <span class="o">+=</span> <span class="o">-</span><span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">J_TO_AU</span> <span class="o">*</span> <span class="n">boltz_prob</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">boltz_prob</span><span class="p">)</span>
                                                    <span class="k">elif</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">boltz_prob</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                                                        <span class="n">h_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span>
                                                        <span class="n">s_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span>
                                                        <span class="n">qh_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                                        <span class="n">qs_conf</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="n">h_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">s_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">g_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>

                                                        <span class="n">qh_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">qs_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">qhg_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span>
                                                                       <span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                        <span class="n">cosmo_qhg_abs</span> <span class="o">+=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span> <span class="o">*</span> <span class="n">boltz_prob</span>
                                                    <span class="k">if</span> <span class="n">cosmo</span><span class="p">:</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">cosmo_qhg</span><span class="p">)</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">conformer</span><span class="p">]</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">)</span>
                                                <span class="k">if</span> <span class="n">gconf</span><span class="p">:</span>
                                                    <span class="n">h_adj</span> <span class="o">=</span> <span class="n">h_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">enthalpy</span>
                                                    <span class="n">h_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">enthalpy</span> <span class="o">+</span> <span class="n">h_adj</span>
                                                    <span class="n">s_adj</span> <span class="o">=</span> <span class="n">s_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">entropy</span>
                                                    <span class="n">s_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">entropy</span> <span class="o">+</span> <span class="n">s_adj</span>
                                                    <span class="n">g_corr</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">s_tot</span>
                                                    <span class="n">qh_adj</span> <span class="o">=</span> <span class="n">qh_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_enthalpy</span>
                                                    <span class="n">qh_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_enthalpy</span> <span class="o">+</span> <span class="n">qh_adj</span>
                                                    <span class="n">qs_adj</span> <span class="o">=</span> <span class="n">qs_conf</span> <span class="o">-</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_entropy</span>
                                                    <span class="n">qs_tot</span> <span class="o">=</span> <span class="n">min_conf</span><span class="o">.</span><span class="n">qh_entropy</span> <span class="o">+</span> <span class="n">qs_adj</span>
                                                    <span class="k">if</span> <span class="n">QH</span><span class="p">:</span>
                                                        <span class="n">qg_corr</span> <span class="o">=</span> <span class="n">qh_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">qs_tot</span>
                                                    <span class="k">else</span><span class="p">:</span>
                                                        <span class="n">qg_corr</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">-</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">qs_tot</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">g_species_qhgzero</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zero_conf</span><span class="p">)</span>  <span class="c1"># Raw data for graphing</span>
                                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Warning! Structure &quot;</span> <span class="o">+</span> <span class="n">structure</span> <span class="o">+</span> <span class="s1">&#39; has not been defined correctly in &#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;   Please edit &quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s2">&quot; and try again</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_abs</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spc_abs</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zpe_abs</span><span class="p">)</span>
                                    <span class="n">conformers</span><span class="p">,</span> <span class="n">single_structure</span><span class="p">,</span> <span class="n">mix</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">g_rel_val</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel_val</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">point_structures</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">structure</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                                            <span class="n">single_structure</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">conformers</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">if</span> <span class="n">conformers</span> <span class="ow">and</span> <span class="n">single_structure</span><span class="p">:</span>
                                        <span class="n">mix</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">if</span> <span class="n">gconf</span> <span class="ow">and</span> <span class="n">min_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">mix</span><span class="p">:</span>
                                            <span class="n">h_mix</span> <span class="o">=</span> <span class="n">h_tot</span> <span class="o">+</span> <span class="n">h_abs</span>
                                            <span class="n">s_mix</span> <span class="o">=</span> <span class="n">s_tot</span> <span class="o">+</span> <span class="n">s_abs</span>
                                            <span class="n">g_mix</span> <span class="o">=</span> <span class="n">g_corr</span> <span class="o">+</span> <span class="n">g_abs</span>
                                            <span class="n">qh_mix</span> <span class="o">=</span> <span class="n">qh_tot</span> <span class="o">+</span> <span class="n">qh_abs</span>
                                            <span class="n">qs_mix</span> <span class="o">=</span> <span class="n">qs_tot</span> <span class="o">+</span> <span class="n">qs_abs</span>
                                            <span class="n">qg_mix</span> <span class="o">=</span> <span class="n">qg_corr</span> <span class="o">+</span> <span class="n">qhg_abs</span>
                                            <span class="n">cosmo_qhg_mix</span> <span class="o">=</span> <span class="n">qg_corr</span> <span class="o">+</span> <span class="n">cosmo_qhg_zero</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_mix</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cosmo_qhg_mix</span><span class="p">)</span>
                                        <span class="k">elif</span> <span class="n">conformers</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_tot</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tot</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_corr</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_tot</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_tot</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_corr</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg_corr</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_abs</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_abs</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_abs</span><span class="p">)</span>

                                        <span class="bp">self</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh_abs</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qs_abs</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qhg_abs</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cosmo_qhg_abs</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>

                            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span></div>


<div class="viewcode-block" id="getoutData"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.getoutData">[docs]</a><span class="k">class</span> <span class="nc">getoutData</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read molecule data from a computational chemistry output file.</span>
<span class="sd">    </span>
<span class="sd">    Currently supports Gaussian and ORCA output types.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        FREQS (list): list of frequencies parsed from Gaussian file.</span>
<span class="sd">        REDMASS (list): list of reduced masses parsed from Gaussian file.</span>
<span class="sd">        FORCECONST (list): list of force constants parsed from Gaussian file.</span>
<span class="sd">        NORMALMODE (list): list of normal modes parsed from Gaussian file.</span>
<span class="sd">        atom_nums (list): list of atom number IDs.</span>
<span class="sd">        atom_types (list): list of atom element symbols.</span>
<span class="sd">        cartesians (list): list of cartesian coordinates for each atom.</span>
<span class="sd">        atomictypes (list): list of atomic types output in Gaussian files.</span>
<span class="sd">        connectivity (list): list of atomic connectivity in a molecule, based on covalent radii</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">program</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Gaussian&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="s2">&quot;* O   R   C   A *&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Orca&quot;</span>
                <span class="k">break</span>

        <span class="k">def</span> <span class="nf">get_freqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outlines</span><span class="p">,</span> <span class="n">natoms</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FREQS</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REDMASS</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FORCECONST</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NORMALMODE</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">freqs_so_far</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlines</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">outlines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; Frequencies -- &quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">nfreqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nfreqs</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">FREQS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">]))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">NORMALMODE</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nfreqs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">REDMASS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nfreqs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">FORCECONST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">]))</span>

                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">natoms</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nfreqs</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">NORMALMODE</span><span class="p">[(</span><span class="n">freqs_so_far</span> <span class="o">+</span> <span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]),</span>
                                     <span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]),</span>
                                     <span class="nb">float</span><span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])])</span>
                        <span class="n">freqs_so_far</span> <span class="o">=</span> <span class="n">freqs_so_far</span> <span class="o">+</span> <span class="n">nfreqs</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="k">def</span> <span class="nf">getatom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outlines</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">oline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outlines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;Input orientation&quot;</span> <span class="ow">in</span> <span class="n">oline</span> <span class="ow">or</span> <span class="s2">&quot;Standard orientation&quot;</span> <span class="ow">in</span> <span class="n">oline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomictypes</span><span class="p">,</span> <span class="n">carts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> \
                                                                                                    <span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">:]</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">carts</span><span class="p">):</span>
                            <span class="k">if</span> <span class="s2">&quot;-------&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">atomictypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])])</span>
            <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Orca&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">oline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outlines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">oline</span> <span class="ow">and</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">oline</span> <span class="ow">and</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">in</span> <span class="n">oline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="p">,</span> <span class="n">carts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">outlines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">carts</span><span class="p">):</span>
                            <span class="k">if</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">getatom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
        <span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_freqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">natoms</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># Convert coordinates to string that can be used by the symmetry.c program</span>
<div class="viewcode-block" id="getoutData.coords_string"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.getoutData.coords_string">[docs]</a>    <span class="k">def</span> <span class="nf">coords_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xyzstring</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_nums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="p">):</span>
            <span class="n">xyzstring</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1:.6f}</span><span class="s2"> </span><span class="si">{2:.6f}</span><span class="s2"> </span><span class="si">{3:.6f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="o">*</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyzstring</span></div>

    <span class="c1"># Obtain molecule connectivity to be used for internal symmetry determination</span>
<div class="viewcode-block" id="getoutData.get_connectivity"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.getoutData.get_connectivity">[docs]</a>    <span class="k">def</span> <span class="nf">get_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cutoff</span> <span class="o">=</span> <span class="n">RADII</span><span class="p">[</span><span class="n">ai</span><span class="p">]</span> <span class="o">+</span> <span class="n">RADII</span><span class="p">[</span><span class="n">aj</span><span class="p">]</span> <span class="o">+</span> <span class="n">tolerance</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cartesians</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span></div></div>



<div class="viewcode-block" id="jitter"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.jitter">[docs]</a><span class="k">def</span> <span class="nf">jitter</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">edgecol</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scatter points that may overlap when graphing by randomly offsetting them.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">edgecol</span><span class="p">,</span>
                <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="graph_reaction_profile"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.graph_reaction_profile">[docs]</a><span class="k">def</span> <span class="nf">graph_reaction_profile</span><span class="p">(</span><span class="n">graph_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">plt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Graph a reaction profile using quasi-harmonic Gibbs free energy values.</span>
<span class="sd">    </span>
<span class="sd">    Use matplotlib package to graph a reaction pathway potential energy surface.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    graph_data (get_pes object): potential energy surface object containing relative thermodynamic data.</span>
<span class="sd">    log (Logger object): Logger to write status updates to user on command line.</span>
<span class="sd">    options (dict): input options for GV.</span>
<span class="sd">    plt (matplotlib): matplotlib library reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.path</span> <span class="k">as</span> <span class="nn">mpath</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Graphing Reaction Profile</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Get PES data</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="n">g_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zero_val</span> <span class="o">=</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">species</span> <span class="o">-</span> <span class="n">zero_val</span>
            <span class="k">if</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">:</span>
                <span class="n">formatted_g</span> <span class="o">=</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">relative</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formatted_g</span> <span class="o">=</span> <span class="n">KCAL_TO_AU</span> <span class="o">*</span> <span class="n">relative</span>  <span class="c1"># Defaults to kcal/mol</span>
            <span class="n">g_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_g</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_data</span>

    <span class="c1"># Grab any additional formatting for graph</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c1">#defaults</span>
    <span class="n">ylim</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_conf</span><span class="p">,</span> <span class="n">show_gconf</span><span class="p">,</span> <span class="n">show_title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
    <span class="n">label_point</span><span class="p">,</span> <span class="n">label_xaxis</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">,</span> <span class="n">gridlines</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span>  <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Potential Energy Surface&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yaml</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;FORMAT&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yaml</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ylim</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">colors</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">title_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">title_input</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span> <span class="ow">or</span> <span class="n">title_input</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
                            <span class="n">show_title</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="n">title_input</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pointlabel&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">label_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">label_input</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                            <span class="n">label_point</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;show_conformers&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">conformers</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">conformers</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                            <span class="n">show_conf</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;show_gconf&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">gconf_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">gconf_input</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                            <span class="n">show_gconf</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">label_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">label_input</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                            <span class="n">label_xaxis</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dpi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">legend_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">legend_input</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                            <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;gridlines&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">gridline_input</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">gridline_input</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                            <span class="n">gridlines</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
    <span class="c1"># Do some graphing</span>
    <span class="n">Path</span> <span class="o">=</span> <span class="n">mpath</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">path_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span>
                    <span class="n">Path</span><span class="p">([(</span><span class="n">j</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])],</span>
                         <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">]),</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span>
                    <span class="n">Path</span><span class="p">([(</span><span class="n">j</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])],</span>
                         <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">]),</span>
                    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">path_patch</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">j</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mf">0.15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span> <span class="o">-</span> <span class="mf">1.15</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.85</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_conf</span><span class="p">:</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">)):</span>  <span class="c1"># i = reaction pathways</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>  <span class="c1"># j = reaction steps</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>  <span class="c1"># k = species</span>
                    <span class="n">zero_val</span> <span class="o">=</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">g_species_qhgzero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">g_qhgvals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">points</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">-</span> <span class="n">zero_val</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span>
                            <span class="n">graph_data</span><span class="o">.</span><span class="n">g_rel_val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span> <span class="o">*</span> <span class="n">KCAL_TO_AU</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">jitter</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">markers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">jitter</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">markers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">show_gconf</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">((</span><span class="n">graph_data</span><span class="o">.</span><span class="n">g_rel_val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">graph_data</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">KCAL_TO_AU</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span>
                                   <span class="n">j</span> <span class="o">+</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

    <span class="c1"># Annotate points with energy level</span>
    <span class="k">if</span> <span class="n">label_point</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">dec</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="o">-</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_figheight</span><span class="p">()</span> <span class="o">*</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">),</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="o">-</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_figheight</span><span class="p">()</span> <span class="o">*</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">),</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">show_title</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reaction Profile&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$G_</span><span class="si">{rel}</span><span class="s2">$ (kcal / mol)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gridlines</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xaxis_text</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">newax_text_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="n">newax_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ax_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xaxis_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newax_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph_data</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">newax_text_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newax_text</span><span class="p">)</span>
    <span class="c1"># Label rxn steps</span>
    <span class="k">if</span> <span class="n">label_xaxis</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaxis_text</span><span class="p">)),</span> <span class="n">xaxis_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaxis_text</span><span class="p">)),</span> <span class="n">xaxis_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>
        <span class="n">newax</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_label</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">newax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newax</span><span class="p">)):</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">newax_text_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;outward&#39;</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="n">newax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaxis_text</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Rxn_profile_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="cosmo_rs_out"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.cosmo_rs_out">[docs]</a><span class="k">def</span> <span class="nf">cosmo_rs_out</span><span class="p">(</span><span class="n">datfile</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read solvation free energies from a COSMO-RS data file</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    datfile (str): name of COSMO-RS output file.</span>
<span class="sd">    names (list): list of species in COSMO-RS file that correspond to names of other computational output files.</span>
<span class="sd">    interval (bool): flag for parser to read COSMO-RS temperature interval calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gsolv</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">datfile</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">datfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datfile</span><span class="p">))</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">t_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gsolv_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">oldtemp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">gsolv_temp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">interval</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Compound&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t_interval</span><span class="p">:</span>
                            <span class="n">t_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Gibbs&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">gsolv</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">/</span> <span class="n">KCAL_TO_AU</span>
                            <span class="n">gsolv_temp</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsolv</span>

                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oldtemp</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">oldtemp</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">oldtemp</span><span class="p">:</span>
                    <span class="n">gsolv_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gsolv</span><span class="p">)</span>  <span class="c1"># Store dict at one temp</span>
                    <span class="n">gsolv</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Clear gsolv</span>
                    <span class="n">gsolv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gsolv_temp</span><span class="p">)</span>  <span class="c1"># Grab the first one for the new temp</span>
                    <span class="n">oldtemp</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="n">gsolv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gsolv_temp</span><span class="p">)</span>
                <span class="n">gsolv_temp</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gsolv_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gsolv</span><span class="p">)</span>  <span class="c1"># Grab last dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Compound&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Gibbs&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">gsolv</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">/</span> <span class="n">KCAL_TO_AU</span>
                        <span class="n">gsolv</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsolv</span>

    <span class="k">if</span> <span class="n">interval</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">t_interval</span><span class="p">,</span> <span class="n">gsolv_dicts</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gsolv</span></div>


<div class="viewcode-block" id="parse_data"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.parse_data">[docs]</a><span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read computational chemistry output file.</span>
<span class="sd">    </span>
<span class="sd">    Attempt to obtain single point energy, program type, program version, solvation_model,</span>
<span class="sd">    charge, empirical_dispersion, and multiplicity from file.</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    file (str): name of file to be parsed.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: single point energy.</span>
<span class="sd">    str: program used to run calculation.</span>
<span class="sd">    str: version of program used to run calculation. </span>
<span class="sd">    str: solvation model used in chemical calculation (if any).</span>
<span class="sd">    str: original filename parsed.</span>
<span class="sd">    int: overall charge of molecule or chemical system.</span>
<span class="sd">    str: empirical dispersion used in chemical calculation (if any).</span>
<span class="sd">    int: multiplicity of molecule or chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spe</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version_program</span><span class="p">,</span> <span class="n">solvation_model</span><span class="p">,</span> <span class="n">keyword_line</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Gaussian&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="s2">&quot;* O   R   C   A *&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Orca&quot;</span>
            <span class="k">break</span>
    <span class="n">repeated_link1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SCF Done:&#39;</span><span class="p">):</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Counterpoise corrected energy&#39;</span><span class="p">):</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="c1"># For MP2 calculations replace with EUMP2</span>
            <span class="k">if</span> <span class="s1">&#39;EUMP2 =&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">))</span>
            <span class="c1"># For ONIOM calculations use the extrapolated value rather than SCF value</span>
            <span class="k">if</span> <span class="s2">&quot;ONIOM: extrapolated energy&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="c1"># For Semi-empirical or Molecular Mechanics calculations</span>
            <span class="k">if</span> <span class="s2">&quot;Energy= &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Predicted&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Thermal&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;Gaussian&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot;Revision&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">repeated_link1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">version_program</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">repeated_link1</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">version_program</span> <span class="o">=</span> <span class="n">version_program</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="s2">&quot;Charge&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Multiplicity&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Multiplicity&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Orca&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;FINAL SINGLE POINT ENERGY&#39;</span><span class="p">):</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;Program Version&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">version_program</span> <span class="o">=</span> <span class="s2">&quot;ORCA version &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;Total Charge&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;....&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;Multiplicity&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;....&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">multiplicity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Solvation model and empirical dispersion detection</span>
    <span class="k">if</span> <span class="s1">&#39;Gaussian&#39;</span> <span class="ow">in</span> <span class="n">version_program</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="s1">&#39;--&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span>
                            <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
                            <span class="n">keyword_line</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">keyword_line</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;scrf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">solvation_model</span> <span class="o">=</span> <span class="s2">&quot;gas phase&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;scrf&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                <span class="n">start_scrf</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span>
                <span class="n">display_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="n">sorted_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; = &#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_scrf</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="s1">&#39; =&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_scrf</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; =&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_scrf</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">start_scrf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">end_scrf</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">display_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                    <span class="n">sorted_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">display_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                    <span class="n">sorted_solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">if</span> <span class="n">solvation_model</span> <span class="o">!=</span> <span class="s2">&quot;gas phase&quot;</span><span class="p">:</span>
            <span class="n">solvation_model</span> <span class="o">=</span> <span class="p">[</span><span class="n">sorted_solvation_model</span><span class="p">,</span> <span class="n">display_solvation_model</span><span class="p">]</span>
        <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;empiricaldispersion&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="s1">&#39;emp=&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;No empirical dispersion detected&quot;</span>
        <span class="k">elif</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;empiricaldispersion&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;empiricaldispersion&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">19</span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">start_emp_disp</span><span class="p">)</span>
                <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s1">&#39;empiricaldispersion=(&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">end_emp_disp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; = &#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="s1">&#39; =&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; =&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_emp_disp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">end_emp_disp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;empiricaldispersion=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;empiricaldispersion=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">end_emp_disp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">elif</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="s1">&#39;emp =&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check for temp keyword </span>
            <span class="n">temp</span><span class="p">,</span> <span class="n">emp_e</span><span class="p">,</span> <span class="n">emp_p</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">check_temp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">)</span>
            <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_temp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">check_temp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">)</span>
                <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_temp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">check_temp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=(&#39;</span><span class="p">)</span>
                <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">)</span>
            <span class="n">check_temp</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">check_temp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Look for a new one </span>
                <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">emp_e</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">emp_e</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">emp_p</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">start_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">,</span> <span class="n">check_temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;No empirical dispersion detected&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="ow">and</span> <span class="n">emp_e</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">temp</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp=&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">temp</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp =&#39;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                    <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">end_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">start_emp_disp</span><span class="p">)</span>
                    <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s1">&#39;empiricaldispersion=(&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">end_emp_disp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39; = &#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                        <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span>
                    <span class="k">elif</span> <span class="s1">&#39; =&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                        <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; =&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]:</span>
                        <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">end_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_emp_disp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">end_emp_disp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;empiricaldispersion=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s2">&quot;empiricaldispersion=(&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">end_emp_disp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">temp</span> <span class="ow">and</span> <span class="n">emp_p</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">temp</span> <span class="ow">and</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;emp(&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">start_emp_disp</span> <span class="o">+=</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">start_emp_disp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">end_emp_disp</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">start_emp_disp</span><span class="p">)</span>
                <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="s1">&#39;empiricaldispersion=(&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">[</span><span class="n">start_emp_disp</span><span class="p">:</span><span class="n">end_emp_disp</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;ORCA&#39;</span> <span class="ow">in</span> <span class="n">version_program</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">keyword_line_1</span> <span class="o">=</span> <span class="s2">&quot;gas phase&quot;</span>
        <span class="n">keyword_line_2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">keyword_line_3</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;CPCM SOLVATION MODEL&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_1</span> <span class="o">=</span> <span class="s2">&quot;CPCM,&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;SMD CDS free energy correction energy&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_2</span> <span class="o">=</span> <span class="s2">&quot;SMD,&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;Solvent:              &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">solvation_model</span> <span class="o">=</span> <span class="n">keyword_line_1</span> <span class="o">+</span> <span class="n">keyword_line_2</span> <span class="o">+</span> <span class="n">keyword_line_3</span>
        <span class="n">empirical_dispersion1</span> <span class="o">=</span> <span class="s1">&#39;No empirical dispersion detected&#39;</span>
        <span class="n">empirical_dispersion2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">empirical_dispersion3</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;DFT DISPERSION CORRECTION&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">empirical_dispersion1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;DFTD3&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">empirical_dispersion2</span> <span class="o">=</span> <span class="s2">&quot;D3&quot;</span>
            <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;USING zero damping&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">empirical_dispersion3</span> <span class="o">=</span> <span class="s1">&#39; with zero damping&#39;</span>
        <span class="n">empirical_dispersion</span> <span class="o">=</span> <span class="n">empirical_dispersion1</span> <span class="o">+</span> <span class="n">empirical_dispersion2</span> <span class="o">+</span> <span class="n">empirical_dispersion3</span>
    <span class="k">return</span> <span class="n">spe</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">version_program</span><span class="p">,</span> <span class="n">solvation_model</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">empirical_dispersion</span><span class="p">,</span> <span class="n">multiplicity</span></div>


<div class="viewcode-block" id="sp_cpu"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.sp_cpu">[docs]</a><span class="k">def</span> <span class="nf">sp_cpu</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read single-point output for cpu time.&quot;&quot;&quot;</span>
    <span class="n">spe</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cpu</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Gaussian&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;* O   R   C   A *&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Orca&quot;</span>
            <span class="k">break</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SCF Done:&#39;</span><span class="p">):</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Job cpu time&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">mins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">secs</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">msecs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="p">[</span><span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">msecs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;Orca&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;FINAL SINGLE POINT ENERGY&#39;</span><span class="p">):</span>
                <span class="n">spe</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;TOTAL RUN TIME&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">mins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">secs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span>
                <span class="n">msecs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">11</span><span class="p">])</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="p">[</span><span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">msecs</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">cpu</span></div>



<div class="viewcode-block" id="level_of_theory"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.level_of_theory">[docs]</a><span class="k">def</span> <span class="nf">level_of_theory</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read output for the level of theory and basis set used.&quot;&quot;&quot;</span>
    <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;External calculation&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="s1">&#39;ext&#39;</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Freq</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="s1">&#39;|Freq|&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">SP</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="s1">&#39;|SP|&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;DLPNO BASED TRIPLES CORRECTION&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;DLPNO-CCSD(T)&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;Estimated CBS total energy&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Extrapol.&quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Remove the restricted R or unrestricted U label</span>
        <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">level_of_theory</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">level</span><span class="p">,</span> <span class="n">bs</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">level_of_theory</span></div>



<div class="viewcode-block" id="read_initial"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.read_initial">[docs]</a><span class="k">def</span> <span class="nf">read_initial</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;At beginning of procedure, read level of theory, solvation model, and check for normal termination&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">level</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">keyword_line</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">progress</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;Incomplete&#39;</span><span class="p">,</span> <span class="s1">&#39;Input&#39;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">no_grid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">DFT</span><span class="p">,</span> <span class="n">dft_used</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">scf_iradan</span><span class="p">,</span> <span class="n">cphf_iradan</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
    <span class="n">grid_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;sg1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;coarse&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;fine&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;ultrafine&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;superfine&#39;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># Determine program to find solvation model used</span>
        <span class="k">if</span> <span class="s2">&quot;Gaussian&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;* O   R   C   A *&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;Orca&quot;</span>
        <span class="c1"># Grab pertinent information from file</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;External calculation&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="s1">&#39;ext&#39;</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Standard orientation:&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;Standard&#39;</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;IExCor=&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">no_grid</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dft_used</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">grid_lookup</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dft_used</span><span class="p">)]</span>
                <span class="n">no_grid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Freq</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="s1">&#39;|Freq|&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">SP</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="s1">&#39;|SP|&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">repeated_theory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">repeated_theory</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;DLPNO BASED TRIPLES CORRECTION&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;DLPNO-CCSD(T)&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;Estimated CBS total energy&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Extrapol.&quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Remove the restricted R or unrestricted U label</span>
        <span class="k">if</span> <span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
   
    <span class="c1"># Grab solvation models - Gaussian files</span>
    <span class="k">if</span> <span class="n">program</span> <span class="ow">is</span> <span class="s1">&#39;Gaussian&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="s1">&#39;--&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span>
                            <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
                            <span class="n">keyword_line</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;Normal termination&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;Error termination&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
        <span class="n">keyword_line</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;scrf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">solvation_model</span> <span class="o">=</span> <span class="s2">&quot;gas phase&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;scrf&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="k">if</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                <span class="n">end_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span>
                <span class="n">solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=&quot;</span> <span class="o">+</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">solvation_model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                    <span class="n">solvation_model</span> <span class="o">=</span> <span class="n">solvation_model</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_scrf2</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;scrf&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">end_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end_scrf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                    <span class="n">solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=(&quot;</span> <span class="o">+</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">solvation_model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                        <span class="n">solvation_model</span> <span class="o">=</span> <span class="n">solvation_model</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">end_scrf</span> <span class="o">=</span> <span class="n">keyword_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">start_scrf</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">end_scrf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keyword_line</span><span class="p">)</span>
                    <span class="n">solvation_model</span> <span class="o">=</span> <span class="s2">&quot;scrf=&quot;</span> <span class="o">+</span> <span class="n">keyword_line</span><span class="p">[</span><span class="n">start_scrf</span><span class="p">:</span><span class="n">end_scrf</span><span class="p">]</span>
    <span class="c1"># ORCA parsing for solvation model </span>
    <span class="k">elif</span> <span class="n">program</span> <span class="ow">is</span> <span class="s1">&#39;Orca&#39;</span><span class="p">:</span>
        <span class="n">keyword_line_1</span> <span class="o">=</span> <span class="s2">&quot;gas phase&quot;</span>
        <span class="n">keyword_line_2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">keyword_line_3</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;CPCM SOLVATION MODEL&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_1</span> <span class="o">=</span> <span class="s2">&quot;CPCM,&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;SMD CDS free energy correction energy&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_2</span> <span class="o">=</span> <span class="s2">&quot;SMD,&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;Solvent:              &quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">keyword_line_3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ORCA TERMINATED NORMALLY&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;error termination&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
        <span class="n">solvation_model</span> <span class="o">=</span> <span class="n">keyword_line_1</span> <span class="o">+</span> <span class="n">keyword_line_2</span> <span class="o">+</span> <span class="n">keyword_line_3</span>
    <span class="n">level_of_theory</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">level</span><span class="p">,</span> <span class="n">bs</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">level_of_theory</span><span class="p">,</span> <span class="n">solvation_model</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">dft_used</span></div>


<div class="viewcode-block" id="jobtype"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.jobtype">[docs]</a><span class="k">def</span> <span class="nf">jobtype</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read output for the level of theory and basis set used.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">job</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">SP</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">+=</span> <span class="s1">&#39;SP&#39;</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">FOpt</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">+=</span> <span class="s1">&#39;GS&#39;</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">FTS</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">+=</span> <span class="s1">&#39;TS&#39;</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Freq</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">+=</span> <span class="s1">&#39;Freq&#39;</span>
    <span class="k">return</span> <span class="n">job</span></div>


<div class="viewcode-block" id="add_time"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.add_time">[docs]</a><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">tm</span><span class="p">,</span> <span class="n">cpu</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate elapsed time.&quot;&quot;&quot;</span>
    <span class="p">[</span><span class="n">days</span><span class="p">,</span> <span class="n">hrs</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">msecs</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu</span>
    <span class="n">fulldate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
    <span class="n">fulldate</span> <span class="o">=</span> <span class="n">fulldate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="n">hrs</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">mins</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="n">secs</span><span class="p">,</span> <span class="n">microseconds</span><span class="o">=</span><span class="n">msecs</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fulldate</span></div>



<div class="viewcode-block" id="calc_translational_energy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_translational_energy">[docs]</a><span class="k">def</span> <span class="nf">calc_translational_energy</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translational energy evaluation</span>

<span class="sd">    Calculates the translational energy (J/mol) of an ideal gas.</span>
<span class="sd">    i.e. non-interacting molecules so molar energy = Na * atomic energy.</span>
<span class="sd">    This approximation applies to all energies and entropies computed within.</span>
<span class="sd">    Etrans = 3/2 RT!</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: translational energy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span>
    <span class="k">return</span> <span class="n">energy</span></div>



<div class="viewcode-block" id="calc_rotational_energy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_rotational_energy">[docs]</a><span class="k">def</span> <span class="nf">calc_rotational_energy</span><span class="p">(</span><span class="n">zpe</span><span class="p">,</span> <span class="n">symmno</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">linear</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotational energy evaluation</span>
<span class="sd">    </span>
<span class="sd">    Calculates the rotational energy (J/mol)</span>
<span class="sd">    Etrans = 0 (atomic) ; RT (linear); 3/2 RT (non-linear)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    zpe (float): zero point energy of chemical system.</span>
<span class="sd">    symmno (float): symmetry number, used for adding a symmetry correction.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    linear (bool): flag for linear molecules, changes how calculation is performed.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: rotational energy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">zpe</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">linear</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span>
    <span class="k">return</span> <span class="n">energy</span></div>


<div class="viewcode-block" id="calc_vibrational_energy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_vibrational_energy">[docs]</a><span class="k">def</span> <span class="nf">calc_vibrational_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vibrational energy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the vibrational energy contribution (J/mol).</span>
<span class="sd">    Includes ZPE (0K) and thermal contributions.</span>
<span class="sd">    Evib = R * Sum(0.5 hv/k + (hv/k)/(e^(hv/KT)-1))</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    frequency_wn (list): list of frequencies parsed from file.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    freq_scale_factor (float): frequency scaling factor based on level of theory and basis set used.</span>
<span class="sd">    fract_modelsys (list): MM frequency scale factors obtained from ONIOM calculations. </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: vibrational energy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fract_modelsys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fract_modelsys</span><span class="p">))]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">frequency_wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="c1"># Error occurs if T is too low when performing math.exp</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entry</span> <span class="o">&gt;</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Warning! Temperature may be too low to calculate vibrational energy. Please adjust using the `-t` option and try again.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)))</span>
              <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span></div>


<div class="viewcode-block" id="calc_zeropoint_energy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_zeropoint_energy">[docs]</a><span class="k">def</span> <span class="nf">calc_zeropoint_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vibrational Zero point energy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the vibrational ZPE (J/mol)</span>
<span class="sd">    EZPE = Sum(0.5 hv/k)</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    frequency_wn (list): list of frequencies parsed from file.</span>
<span class="sd">    freq_scale_factor (float): frequency scaling factor based on level of theory and basis set used.</span>
<span class="sd">    fract_modelsys (list): MM frequency scale factors obtained from ONIOM calculations. </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: zerp point energy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fract_modelsys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fract_modelsys</span><span class="p">))]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">frequency_wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">entry</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span></div>




<div class="viewcode-block" id="get_free_space"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.get_free_space">[docs]</a><span class="k">def</span> <span class="nf">get_free_space</span><span class="p">(</span><span class="n">solv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computed the amount of accessible free space (ml per L) in solution.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the free space in a litre of bulk solvent, based on</span>
<span class="sd">    Shakhnovich and Whitesides (J. Org. Chem. 1998, 63, 3821-3830).</span>
<span class="sd">    Free space based on accessible to a solute immersed in bulk solvent, </span>
<span class="sd">    i.e. this is the volume not occupied by solvent molecules, calculated using </span>
<span class="sd">    literature values for molarity and B3LYP/6-31G* computed molecular volumes.</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    solv (str): solvent used in chemical calculation.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: accessible free space in solution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solvent_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">,</span> <span class="s2">&quot;toluene&quot;</span><span class="p">,</span> <span class="s2">&quot;DMF&quot;</span><span class="p">,</span> <span class="s2">&quot;AcOH&quot;</span><span class="p">,</span> <span class="s2">&quot;chloroform&quot;</span><span class="p">]</span>
    <span class="n">molarity</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">55.6</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">12.9</span><span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">]</span>  <span class="c1"># mol/l</span>
    <span class="n">molecular_vol</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">27.944</span><span class="p">,</span> <span class="mf">149.070</span><span class="p">,</span> <span class="mf">77.442</span><span class="p">,</span> <span class="mf">86.10</span><span class="p">,</span> <span class="mf">97.0</span><span class="p">]</span>  <span class="c1"># Angstrom^3</span>

    <span class="n">nsolv</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">solvent_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">solv</span> <span class="o">==</span> <span class="n">solvent_list</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nsolv</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">solv_molarity</span> <span class="o">=</span> <span class="n">molarity</span><span class="p">[</span><span class="n">nsolv</span><span class="p">]</span>
    <span class="n">solv_volume</span> <span class="o">=</span> <span class="n">molecular_vol</span><span class="p">[</span><span class="n">nsolv</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nsolv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v_free</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1E27</span> <span class="o">/</span> <span class="p">(</span><span class="n">solv_molarity</span> <span class="o">*</span> <span class="n">AVOGADRO_CONSTANT</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.333333</span> <span class="o">-</span> <span class="n">solv_volume</span> <span class="o">**</span> <span class="mf">0.333333</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="n">freespace</span> <span class="o">=</span> <span class="n">v_free</span> <span class="o">*</span> <span class="n">solv_molarity</span> <span class="o">*</span> <span class="n">AVOGADRO_CONSTANT</span> <span class="o">*</span> <span class="mf">1E-24</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freespace</span> <span class="o">=</span> <span class="mf">1000.0</span>
    <span class="k">return</span> <span class="n">freespace</span></div>


<div class="viewcode-block" id="calc_translational_entropy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_translational_entropy">[docs]</a><span class="k">def</span> <span class="nf">calc_translational_entropy</span><span class="p">(</span><span class="n">molecular_mass</span><span class="p">,</span> <span class="n">conc</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">solv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translational entropy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the translational entropic contribution (J/(mol*K)) of an ideal gas.</span>
<span class="sd">    Needs the molecular mass. Convert mass in amu to kg; conc in mol/l to number per m^3</span>
<span class="sd">    Strans = R(Ln(2pimkT/h^2)^3/2(1/C)) + 1 + 3/2)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    molecular_mass (float): total molecular mass of chemical system.</span>
<span class="sd">    conc (float): concentration to perform calculations at.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    solv (str): solvent used in chemical calculation.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: translational entropy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lmda</span> <span class="o">=</span> <span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">molecular_mass</span> <span class="o">*</span> <span class="n">AMU_to_KG</span> <span class="o">*</span> <span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">PLANCK_CONSTANT</span>
    <span class="n">freespace</span> <span class="o">=</span> <span class="n">get_free_space</span><span class="p">(</span><span class="n">solv</span><span class="p">)</span>
    <span class="n">ndens</span> <span class="o">=</span> <span class="n">conc</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">AVOGADRO_CONSTANT</span> <span class="o">/</span> <span class="p">(</span><span class="n">freespace</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
    <span class="n">entropy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.5</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lmda</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">ndens</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="calc_electronic_entropy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_electronic_entropy">[docs]</a><span class="k">def</span> <span class="nf">calc_electronic_entropy</span><span class="p">(</span><span class="n">multiplicity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Electronic entropy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the electronic entropic contribution (J/(mol*K)) of the molecule</span>
<span class="sd">    Selec = R(Ln(multiplicity)</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">    multiplicity (int): multiplicity of chemical system.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: electronic entropy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entropy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">multiplicity</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="calc_rotational_entropy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_rotational_entropy">[docs]</a><span class="k">def</span> <span class="nf">calc_rotational_entropy</span><span class="p">(</span><span class="n">zpe</span><span class="p">,</span> <span class="n">linear</span><span class="p">,</span> <span class="n">symmno</span><span class="p">,</span> <span class="n">rotemp</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotational entropy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Calculates the rotational entropy (J/(mol*K))</span>
<span class="sd">    Strans = 0 (atomic) ; R(Ln(q)+1) (linear); R(Ln(q)+3/2) (non-linear)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    zpe (float): zero point energy of chemical system.</span>
<span class="sd">    linear (bool): flag for linear molecules.</span>
<span class="sd">    symmno (float): symmetry number of chemical system.</span>
<span class="sd">    rotemp (list): list of parsed rotational temperatures of chemical system.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: rotational entropy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rotemp</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">zpe</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>  <span class="c1"># Monatomic</span>
        <span class="n">entropy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotemp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Diatomic or linear molecules</span>
            <span class="n">linear</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">qrot</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="n">rotemp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotemp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Possible gaussian problem with linear triatomic</span>
            <span class="n">linear</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qrot</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">rotemp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rotemp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rotemp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">qrot</span> <span class="o">=</span> <span class="n">qrot</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">linear</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">entropy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">qrot</span> <span class="o">/</span> <span class="n">symmno</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">linear</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">entropy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entropy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">qrot</span> <span class="o">/</span> <span class="n">symmno</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="calc_rrho_entropy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_rrho_entropy">[docs]</a><span class="k">def</span> <span class="nf">calc_rrho_entropy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rigid rotor harmonic oscillator (RRHO) entropy evaluation - this is the default treatment</span>
<span class="sd">    </span>
<span class="sd">    Entropic contributions (J/(mol*K)) according to a rigid-rotor</span>
<span class="sd">    harmonic-oscillator description for a list of vibrational modes</span>
<span class="sd">    Sv = RSum(hv/(kT(e^(hv/kT)-1) - ln(1-e^(-hv/kT)))</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    frequency_wn (list): list of frequencies parsed from file.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    freq_scale_factor (float): frequency scaling factor based on level of theory and basis set used.</span>
<span class="sd">    fract_modelsys (list): MM frequency scale factors obtained from ONIOM calculations. </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: RRHO entropy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fract_modelsys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fract_modelsys</span><span class="p">))]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">frequency_wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span>
                  <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="n">entropy</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">entry</span><span class="p">))</span>
               <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="calc_qRRHO_energy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_qRRHO_energy">[docs]</a><span class="k">def</span> <span class="nf">calc_qRRHO_energy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quasi-rigid rotor harmonic oscillator energy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Head-Gordon RRHO-vibrational energy contribution (J/mol*K) of</span>
<span class="sd">    vibrational modes described by a rigid-rotor harmonic approximation.</span>
<span class="sd">    V_RRHO = 1/2(Nhv) + RT(hv/kT)e^(-hv/kT)/(1-e^(-hv/kT))</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    frequency_wn (list): list of frequencies parsed from file.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    freq_scale_factor (float): frequency scaling factor based on level of theory and basis set used.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: quasi-RRHO energy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLANCK_CONSTANT</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">AVOGADRO_CONSTANT</span> <span class="o">*</span> <span class="n">entry</span> <span class="o">+</span> <span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">entry</span> <span class="o">/</span> <span class="n">BOLTZMANN_CONSTANT</span>
              <span class="o">/</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">entry</span> <span class="o">/</span> <span class="n">BOLTZMANN_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">/</span>
              <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">entry</span> <span class="o">/</span> <span class="n">BOLTZMANN_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">))</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">energy</span></div>


<div class="viewcode-block" id="calc_freerot_entropy"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_freerot_entropy">[docs]</a><span class="k">def</span> <span class="nf">calc_freerot_entropy</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">fract_modelsys</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">inertia</span><span class="p">,</span> <span class="n">roconst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Free rotor entropy evaluation.</span>
<span class="sd">    </span>
<span class="sd">    Entropic contributions (J/(mol*K)) according to a free-rotor</span>
<span class="sd">    description for a list of vibrational modes</span>
<span class="sd">    Sr = R(1/2 + 1/2ln((8pi^3u&#39;kT/h^2))</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    frequency_wn (list): list of frequencies parsed from file.</span>
<span class="sd">    temperature (float): temperature for calculations to be performed at.</span>
<span class="sd">    freq_scale_factor (float): frequency scaling factor based on level of theory and basis set used.</span>
<span class="sd">    fract_modelsys (list): MM frequency scale factors obtained from ONIOM calculations. </span>
<span class="sd">    inertia (str): flag for choosing global average moment of inertia for all molecules or computing individually from parsed rotational constants</span>
<span class="sd">    roconst (list): list of parsed rotational constants for computing the average moment of inertia.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: free rotor entropy of chemical system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is the average moment of inertia used by Grimme</span>
    <span class="k">if</span> <span class="n">inertia</span> <span class="o">==</span> <span class="s2">&quot;global&quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">roconst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bav</span> <span class="o">=</span> <span class="mf">1.00e-44</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Found Rotational Constants for &quot;</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">roconst</span><span class="p">)</span>
        <span class="n">av_roconst_ghz</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">roconst</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">roconst</span><span class="p">)</span>  <span class="c1">#GHz</span>
        <span class="n">av_roconst_hz</span> <span class="o">=</span> <span class="n">av_roconst_ghz</span> <span class="o">*</span> <span class="mi">1000000000</span> <span class="c1">#Hz</span>
        <span class="n">av_roconst_s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">av_roconst_hz</span>            <span class="c1">#s</span>
        <span class="n">av_roconst</span> <span class="o">=</span> <span class="n">av_roconst_s</span> <span class="o">*</span> <span class="n">PLANCK_CONSTANT</span> <span class="c1">#kg m^2</span>
        <span class="n">bav</span> <span class="o">=</span> <span class="n">av_roconst</span>
    
    <span class="k">if</span> <span class="n">fract_modelsys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_modelsys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fract_modelsys</span><span class="p">))]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLANCK_CONSTANT</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">frequency_wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
              <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLANCK_CONSTANT</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">SPEED_OF_LIGHT</span> <span class="o">*</span> <span class="n">freq_scale_factor</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="n">mu_primed</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="o">*</span> <span class="n">bav</span> <span class="o">/</span> <span class="p">(</span><span class="n">entry</span> <span class="o">+</span> <span class="n">bav</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">mu</span><span class="p">]</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">entry</span> <span class="o">*</span> <span class="n">BOLTZMANN_CONSTANT</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="n">PLANCK_CONSTANT</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">mu_primed</span><span class="p">]</span>
    <span class="n">entropy</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">entry</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="n">GAS_CONSTANT</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="calc_damp"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.calc_damp">[docs]</a><span class="k">def</span> <span class="nf">calc_damp</span><span class="p">(</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">freq_cutoff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A damping function to interpolate between RRHO and free rotor vibrational entropy values&quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">damp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">freq_cutoff</span> <span class="o">/</span> <span class="n">entry</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">frequency_wn</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">damp</span></div>


<div class="viewcode-block" id="get_selectivity"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.get_selectivity">[docs]</a><span class="k">def</span> <span class="nf">get_selectivity</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">boltz_sum</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">dup_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate selectivity as enantioselectivity/diastereomeric ratio.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    pattern (str): pattern to recognize for selectivity calculation, i.e. &quot;R&quot;:&quot;S&quot;.</span>
<span class="sd">    files (str): files to use for selectivity calculation.</span>
<span class="sd">    boltz_facs (dict): dictionary of Boltzmann factors for each file used in the calculation.</span>
<span class="sd">    boltz_sum (float) </span>
<span class="sd">    temperature (float)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: enantiomeric/diasteriomeric ratio.</span>
<span class="sd">    str: pattern used to identify ratio.</span>
<span class="sd">    float: Gibbs free energy barrier.</span>
<span class="sd">    bool: flag for failed selectivity calculation.</span>
<span class="sd">    str: preferred enantiomer/diastereomer configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">dirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="n">dirs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dirs</span><span class="p">))</span>
    <span class="n">a_files</span><span class="p">,</span> <span class="n">b_files</span><span class="p">,</span> <span class="n">a_sum</span><span class="p">,</span> <span class="n">b_sum</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">pref</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    
    <span class="p">[</span><span class="n">a_regex</span><span class="p">,</span><span class="n">b_regex</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="n">a_regex</span><span class="p">,</span><span class="n">b_regex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_regex</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">b_regex</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">a_regex</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">isalnum</span><span class="p">())</span>
    <span class="n">B</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">b_regex</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">isalnum</span><span class="p">())</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">a_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">a_regex</span><span class="p">))</span>
            <span class="n">b_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">b_regex</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">a_regex</span><span class="p">))</span>
        <span class="n">b_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">b_regex</span><span class="p">))</span>
        
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_files</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_files</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Warning! Filenames have not been formatted correctly for determining selectivity</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Make sure the filename contains either &quot;</span> <span class="o">+</span> <span class="n">A</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;   Please edit either your filenames or selectivity pattern argument and try again</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Grab Boltzmann sums</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="n">dup_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">file</span><span class="p">:</span> <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">duplicate</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">a_files</span><span class="p">:</span>
                <span class="n">a_sum</span> <span class="o">+=</span> <span class="n">boltz_facs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">/</span> <span class="n">boltz_sum</span>
            <span class="k">elif</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">b_files</span><span class="p">:</span>
                <span class="n">b_sum</span> <span class="o">+=</span> <span class="n">boltz_facs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">/</span> <span class="n">boltz_sum</span>
    <span class="c1"># Get ratios</span>
    <span class="n">A_round</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">a_sum</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">B_round</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">b_sum</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">A_round</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">B_round</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a_sum</span> <span class="o">&gt;</span> <span class="n">b_sum</span><span class="p">:</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="n">A</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">a_sum</span> <span class="o">/</span> <span class="n">b_sum</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;:1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;:1&#39;</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="s1">&#39;1:0&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="n">B</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">b_sum</span> <span class="o">/</span> <span class="n">a_sum</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="s1">&#39;1:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="s1">&#39;1:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="s1">&#39;0:1&#39;</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_sum</span> <span class="o">-</span> <span class="n">b_sum</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.</span>
    <span class="k">if</span> <span class="n">ee</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Warning! No files found for an enantioselectivity analysis, adjust the stereodetermining step name and try again.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ee</span> <span class="o">&gt;</span> <span class="mf">99.99</span><span class="p">:</span>
        <span class="n">ee</span> <span class="o">=</span> <span class="mf">99.99</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dd_free_energy</span> <span class="o">=</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">J_TO_AU</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">50</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">KCAL_TO_AU</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">dd_free_energy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">ee</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">dd_free_energy</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">pref</span></div>


<div class="viewcode-block" id="get_boltz"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.get_boltz">[docs]</a><span class="k">def</span> <span class="nf">get_boltz</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">clustering</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">dup_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain Boltzmann factors, Boltzmann sums, and weighted free energy values.</span>
<span class="sd">    </span>
<span class="sd">    Used for selectivity and boltzmann requested options.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    files (list): list of files to find Boltzmann factors for.</span>
<span class="sd">    thermo_data (dict): dict of calc_bbe objects with thermodynamic data to use for Boltzmann averaging. </span>
<span class="sd">    clustering (bool): flag for file clustering</span>
<span class="sd">    clusters (list): definitions for the requested clusters</span>
<span class="sd">    temperature (float): temperature to compute Boltzmann populations at</span>
<span class="sd">    dup_list (list): list of potential duplicates</span>
<span class="sd">    </span>
<span class="sd">    Returns:boltz_facs, weighted_free_energy, boltz_sum</span>
<span class="sd">    dict: dictionary of files with corresponding Boltzmann factors.</span>
<span class="sd">    dict: dictionary of files with corresponding weighted Gibbs free energy.</span>
<span class="sd">    float: Boltzmann sum computed from Boltzmann factors and Gibbs free energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">weighted_free_energy</span><span class="p">,</span> <span class="n">e_rel</span><span class="p">,</span> <span class="n">e_min</span><span class="p">,</span> <span class="n">boltz_sum</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>  <span class="c1"># Need the most stable structure</span>
        <span class="n">bbe</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">&lt;</span> <span class="n">e_min</span><span class="p">:</span>
                    <span class="n">e_min</span> <span class="o">=</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>

    <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
            <span class="n">boltz_facs</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">weighted_free_energy</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Calculate E_rel and Boltzmann factors</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="n">dup_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">file</span><span class="p">:</span> <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicate</span><span class="p">:</span>

            <span class="n">bbe</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">e_rel</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">-</span> <span class="n">e_min</span>
                    <span class="n">boltz_facs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">e_rel</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">structure</span> <span class="o">==</span> <span class="n">file</span><span class="p">:</span>
                                    <span class="n">boltz_facs</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                                        <span class="o">-</span><span class="n">e_rel</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>
                                    <span class="n">weighted_free_energy</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                                        <span class="o">-</span><span class="n">e_rel</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span>
                    <span class="n">boltz_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">e_rel</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temperature</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">weighted_free_energy</span><span class="p">,</span> <span class="n">boltz_sum</span></div>


<span class="c1"># Check for duplicate species from among all files based on energy, rotational constants and frequencies</span>
<span class="c1"># Energy cutoff = 1 microHartree; RMS Rotational Constant cutoff = 1kHz; RMS Freq cutoff = 10 wavenumbers</span>
<div class="viewcode-block" id="check_dup"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.check_dup">[docs]</a><span class="k">def</span> <span class="nf">check_dup</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for duplicate species from among all files based on energy, rotational constants and frequencies</span>
<span class="sd">    </span>
<span class="sd">    Energy cutoff = 1 microHartree</span>
<span class="sd">    RMS Rotational Constant cutoff = 1kHz</span>
<span class="sd">    RMS Freq cutoff = 10 wavenumbers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e_cutoff</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">ro_cutoff</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">freq_cutoff</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">mae_freq_cutoff</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">max_freq_cutoff</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">dup_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">freq_diff</span><span class="p">,</span> <span class="n">mae_freq_diff</span><span class="p">,</span> <span class="n">max_freq_diff</span><span class="p">,</span> <span class="n">e_diff</span><span class="p">,</span> <span class="n">ro_diff</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">bbe_i</span><span class="p">,</span> <span class="n">bbe_j</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_i</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_j</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">):</span>
                <span class="n">e_diff</span> <span class="o">=</span> <span class="n">bbe_i</span><span class="o">.</span><span class="n">scf_energy</span> <span class="o">-</span> <span class="n">bbe_j</span><span class="o">.</span><span class="n">scf_energy</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_i</span><span class="p">,</span> <span class="s2">&quot;roconst&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_j</span><span class="p">,</span> <span class="s2">&quot;roconst&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">roconst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_j</span><span class="o">.</span><span class="n">roconst</span><span class="p">):</span>
                    <span class="n">ro_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">roconst</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bbe_j</span><span class="o">.</span><span class="n">roconst</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_i</span><span class="p">,</span> <span class="s2">&quot;frequency_wn&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe_j</span><span class="p">,</span> <span class="s2">&quot;frequency_wn&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_j</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">freq_diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">freqi</span> <span class="o">-</span> <span class="n">freqj</span><span class="p">)</span> <span class="k">for</span> <span class="n">freqi</span><span class="p">,</span> <span class="n">freqj</span> <span class="ow">in</span>
                                 <span class="nb">zip</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">,</span> <span class="n">bbe_j</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)]</span>
                    <span class="n">mae_freq_diff</span><span class="p">,</span> <span class="n">max_freq_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">freq_diff</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq_diff</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_j</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe_i</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">mae_freq_diff</span><span class="p">,</span> <span class="n">max_freq_diff</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="n">e_diff</span> <span class="o">&lt;</span> <span class="n">e_cutoff</span> <span class="ow">and</span> <span class="n">ro_diff</span> <span class="o">&lt;</span> <span class="n">ro_cutoff</span> <span class="ow">and</span> <span class="n">mae_freq_diff</span> <span class="o">&lt;</span> <span class="n">mae_freq_cutoff</span> <span class="ow">and</span> <span class="n">max_freq_diff</span> <span class="o">&lt;</span> <span class="n">max_freq_cutoff</span><span class="p">:</span>
                <span class="n">dup_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">files</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">dup_list</span></div>


<div class="viewcode-block" id="print_check_fails"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.print_check_fails">[docs]</a><span class="k">def</span> <span class="nf">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">check_attribute</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">option2</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function for printing checks to the terminal&quot;&quot;&quot;</span>
    <span class="n">unique_attr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">check_attribute</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">option2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">attr</span> <span class="o">=</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">option2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_attr</span><span class="p">:</span>
            <span class="n">unique_attr</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unique_attr</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Different </span><span class="si">{}</span><span class="s2"> found: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">unique_attr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">option2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">       </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">        </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">        -</span><span class="si">{}</span><span class="s1">: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">unique_attr</span><span class="p">[</span><span class="n">attr</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="n">unique_attr</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_files"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.check_files">[docs]</a><span class="k">def</span> <span class="nf">check_files</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">STARS</span><span class="p">,</span> <span class="n">l_o_t</span><span class="p">,</span> <span class="n">solvation_model</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform checks for consistency in calculation output files for computational projects</span>
<span class="sd">    </span>
<span class="sd">    Check for consistency in: Gaussian version, solvation state/gas phase,</span>
<span class="sd">    level of theory/basis set, charge and multiplicity, standard concentration,</span>
<span class="sd">    potential linear molecule errors, transition state verification, empirical dispersion models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Checks for thermochemistry calculations (frequency calculations):&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">STARS</span><span class="p">)</span>
    <span class="c1"># Check program used and version</span>
    <span class="n">version_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">version_program</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="n">file_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">file</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">version_check</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using </span><span class="si">{}</span><span class="s2"> in all calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">version_check</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;programs or versions&quot;</span><span class="p">)</span>

    <span class="c1"># Check level of theory</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using </span><span class="si">{}</span><span class="s2"> in all calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">l_o_t</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;levels of theory&quot;</span><span class="p">)</span>

    <span class="c1"># Check for solvent models</span>
    <span class="n">solvent_check</span> <span class="o">=</span> <span class="n">solvation_model</span>
    <span class="n">solvent_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">solvation_model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">solvent_check</span><span class="p">):</span>
        <span class="n">solvent_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">solvation_model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using </span><span class="si">{}</span><span class="s2"> in all calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">solvent_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">solvation_model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">solvent_check</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;solvation models&quot;</span><span class="p">)</span>

    <span class="c1"># Check for -c 1 when solvent is added</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">solvent_check</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.0408740470708</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using a standard concentration of 1 atm for gas phase.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.0408740470708</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Standard concentration is not 1 atm for gas phase (using </span><span class="si">{}</span><span class="s2"> M).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.0408740470708</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Using a standard concentration of 1 atm for solvent phase (option -c 1 should be included for 1 M).&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using a standard concentration of 1 M for solvent phase.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvent_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.0408740470708</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Standard concentration is not 1 M for solvent phase (using </span><span class="si">{}</span><span class="s2"> M).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">solvent_check</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">in</span> <span class="n">solvent_check</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! The right standard concentration cannot be determined because the calculations use a combination of gas and solvent phases.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">solvent_check</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="s2">&quot;gas phase&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">solvent_check</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Different solvents used, fix this issue and use option -c 1 for a standard concentration of 1 M.&quot;</span><span class="p">)</span>

    <span class="c1"># Check charge and multiplicity</span>
    <span class="n">charge_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="n">multiplicity_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">multiplicity</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">charge_check</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">all_same</span><span class="p">(</span><span class="n">multiplicity_check</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using charge </span><span class="si">{}</span><span class="s2"> and multiplicity </span><span class="si">{}</span><span class="s2"> in all calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charge_check</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                         <span class="n">multiplicity_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">charge_check</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;charge and multiplicity&quot;</span><span class="p">,</span> <span class="n">multiplicity_check</span><span class="p">)</span>

    <span class="c1"># Check for duplicate structures</span>
    <span class="n">dup_list</span> <span class="o">=</span> <span class="n">check_dup</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  No duplicates or enantiomers found&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Possible duplicates or enantiomers found:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="n">dup_list</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">        </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># Check for linear molecules with incorrect number of vibrational modes</span>
    <span class="n">linear_fails</span><span class="p">,</span> <span class="n">linear_fails_atom</span><span class="p">,</span> <span class="n">linear_fails_cart</span><span class="p">,</span> <span class="n">linear_fails_files</span><span class="p">,</span> <span class="n">linear_fails_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">linear_fails</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">linear_fails_cart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails</span><span class="o">.</span><span class="n">cartesians</span><span class="p">)</span>
        <span class="n">linear_fails_atom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails</span><span class="o">.</span><span class="n">atom_types</span><span class="p">)</span>
        <span class="n">linear_fails_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">frequency_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">frequency_wn</span><span class="p">)</span>

    <span class="n">linear_fails_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_atom</span><span class="p">)</span>
    <span class="n">linear_fails_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_cart</span><span class="p">)</span>
    <span class="n">linear_fails_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)</span>
    <span class="n">linear_fails_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_files</span><span class="p">)</span>

    <span class="n">linear_mol_correct</span><span class="p">,</span> <span class="n">linear_mol_wrong</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">count_linear</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">linear_mol_correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linear_mol_wrong</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">linear_mol_correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">linear_mol_wrong</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                                <span class="k">if</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]:</span>
                                    <span class="k">if</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> \
                                            <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">):</span>
                                        <span class="n">count_linear</span> <span class="o">=</span> <span class="n">count_linear</span> <span class="o">+</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="n">count_linear</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                                                <span class="n">linear_mol_correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">linear_mol_wrong</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">linear_mol_correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">linear_mol_wrong</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_fails_list</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">linear_correct_print</span><span class="p">,</span> <span class="n">linear_wrong_print</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_correct</span><span class="p">)):</span>
        <span class="n">linear_correct_print</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">linear_mol_correct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_wrong</span><span class="p">)):</span>
        <span class="n">linear_wrong_print</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">linear_mol_wrong</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">linear_correct_print</span> <span class="o">=</span> <span class="n">linear_correct_print</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">linear_wrong_print</span> <span class="o">=</span> <span class="n">linear_wrong_print</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_correct</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_wrong</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-  No linear molecules found.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_wrong</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Potential linear molecules with wrong number of frequencies found &quot;</span>
                      <span class="s2">&quot;(correct number = 3N-5) -</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">linear_wrong_print</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_correct</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_wrong</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  All the linear molecules have the correct number of frequencies -</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">linear_correct_print</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_mol_wrong</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! Potential linear molecules with wrong number of frequencies found -</span><span class="si">{}</span><span class="s2">. Correct &quot;</span>
                      <span class="s2">&quot;number of frequencies (3N-5) found in other calculations -</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">linear_wrong_print</span><span class="p">,</span>
                                                                                             <span class="n">linear_correct_print</span><span class="p">))</span>

    <span class="c1"># Checks whether any TS have &gt; 1 imaginary frequency and any GS have any imaginary frequencies</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">bbe</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">im_frequency_wn</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution! TS </span><span class="si">{}</span><span class="s2"> does not have 1 imaginary frequency greater than -50 wavenumbers.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;GS&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">bbe</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">im_frequency_wn</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  Caution: GS </span><span class="si">{}</span><span class="s2"> has 1 or more imaginary frequencies greater than -50 wavenumbers.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="c1"># Check for empirical dispersion</span>
    <span class="n">dispersion_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">empirical_dispersion</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">dispersion_check</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dispersion_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;No empirical dispersion detected&#39;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-  No empirical dispersion detected in any of the calculations.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using &quot;</span> <span class="o">+</span> <span class="n">dispersion_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; in all calculations.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">dispersion_check</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;dispersion models&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">STARS</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check for single-point corrections</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Checks for single-point corrections:&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">STARS</span><span class="p">)</span>
        <span class="n">names_spc</span><span class="p">,</span> <span class="n">version_check_spc</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span>
                <span class="n">names_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">):</span>
                <span class="n">names_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">)</span>

        <span class="c1"># Check SPC program versions</span>
        <span class="n">version_check_spc</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sp_version_program</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">version_check_spc</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using </span><span class="si">{}</span><span class="s2"> in all the single-point corrections.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">version_check_spc</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;programs or versions&quot;</span><span class="p">)</span>

        <span class="c1"># Check SPC solvation</span>
        <span class="n">solvent_check_spc</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sp_solvation_model</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">solvent_check_spc</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solvent_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using &quot;</span> <span class="o">+</span> <span class="n">solvent_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; in all single-point corrections.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using &quot;</span> <span class="o">+</span> <span class="n">solvent_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; in all single-point corrections.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">solvent_check_spc</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;solvation models&quot;</span><span class="p">)</span>

        <span class="c1"># Check SPC level of theory</span>
        <span class="n">l_o_t_spc</span> <span class="o">=</span> <span class="p">[</span><span class="n">level_of_theory</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names_spc</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t_spc</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using </span><span class="si">{}</span><span class="s2"> in all the single-point corrections.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l_o_t_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">l_o_t_spc</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;levels of theory&quot;</span><span class="p">)</span>

        <span class="c1"># Check SPC charge and multiplicity</span>
        <span class="n">charge_spc_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sp_charge</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="n">multiplicity_spc_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sp_multiplicity</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">charge_spc_check</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">all_same</span><span class="p">(</span><span class="n">multiplicity_spc_check</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using charge and multiplicity </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> in all the single-point corrections.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">charge_spc_check</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">multiplicity_spc_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">charge_spc_check</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;charge and multiplicity&quot;</span><span class="p">,</span> <span class="n">multiplicity_spc_check</span><span class="p">)</span>

        <span class="c1"># Check if the geometries of freq calculations match their corresponding structures in single-point calculations</span>
        <span class="n">geom_duplic_list</span><span class="p">,</span> <span class="n">geom_duplic_list_spc</span><span class="p">,</span> <span class="n">geom_duplic_cart</span><span class="p">,</span> <span class="n">geom_duplic_files</span><span class="p">,</span> <span class="n">geom_duplic_cart_spc</span><span class="p">,</span> <span class="n">geom_duplic_files_spc</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">geom_duplic</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">geom_duplic_cart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic</span><span class="o">.</span><span class="n">cartesians</span><span class="p">)</span>
            <span class="n">geom_duplic_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">geom_duplic_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic_cart</span><span class="p">)</span>
        <span class="n">geom_duplic_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic_files</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names_spc</span><span class="p">:</span>
            <span class="n">geom_duplic_spc</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">geom_duplic_cart_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic_spc</span><span class="o">.</span><span class="n">cartesians</span><span class="p">)</span>
            <span class="n">geom_duplic_files_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">geom_duplic_list_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic_cart_spc</span><span class="p">)</span>
        <span class="n">geom_duplic_list_spc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_duplic_files_spc</span><span class="p">)</span>
        <span class="n">spc_mismatching</span> <span class="o">=</span> <span class="s2">&quot;Caution! Potential differences found between frequency and single-point geometries -&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="k">elif</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
                            <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_duplic_list_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">spc_mismatching</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">geom_duplic_list</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">spc_mismatching</span> <span class="o">==</span> <span class="s2">&quot;Caution! Potential differences found between frequency and single-point geometries -&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  No potential differences found between frequency and single-point geometries (based on input coordinates).&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spc_mismatching_1</span> <span class="o">=</span> <span class="n">spc_mismatching</span><span class="p">[:</span><span class="mi">84</span><span class="p">]</span>
                <span class="n">spc_mismatching_2</span> <span class="o">=</span> <span class="n">spc_mismatching</span><span class="p">[</span><span class="mi">85</span><span class="p">:]</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="n">spc_mismatching_1</span> <span class="o">+</span> <span class="n">spc_mismatching_2</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  One or more geometries from single-point corrections are missing.&quot;</span><span class="p">)</span>

        <span class="c1"># Check for SPC dispersion models</span>
        <span class="n">dispersion_check_spc</span> <span class="o">=</span> <span class="p">[</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sp_empirical_dispersion</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">dispersion_check_spc</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dispersion_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;No empirical dispersion detected&#39;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-  No empirical dispersion detected in any of the calculations.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  Using &quot;</span> <span class="o">+</span> <span class="n">dispersion_check_spc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; in all the singe-point calculations.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">dispersion_check_spc</span><span class="p">,</span> <span class="n">file_check</span><span class="p">,</span> <span class="s2">&quot;dispersion models&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">STARS</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../source/goodvibes.html#goodvibes.GoodVibes.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bbe_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;   Requested: &#39;</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Get command line inputs. Use -h to list all possible arguments and default values</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Quasi-harmonic entropy correction and enthalpy correction applied (default S=Grimme, &quot;</span>
                             <span class="s2">&quot;H=Head-Gordon)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--qs&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;QS&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;grimme&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;QS&quot;</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grimme&#39;</span><span class="p">,</span> <span class="s1">&#39;truhlar&#39;</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Type of quasi-harmonic entropy correction (Grimme or Truhlar) (default Grimme)&quot;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--qh&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;QH&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Type of quasi-harmonic enthalpy correction (Head-Gordon)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;freq_cutoff&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FREQ_CUTOFF&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cut-off frequency for both entropy and enthalpy (wavenumbers) (default = 100)&quot;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fs&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;S_freq_cutoff&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;S_FREQ_CUTOFF&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cut-off frequency for entropy (wavenumbers) (default = 100)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fh&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;H_freq_cutoff&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;H_FREQ_CUTOFF&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cut-off frequency for enthalpy (wavenumbers) (default = 100)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Temperature (K) (default 298.15)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;conc&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;CONC&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Concentration (mol/l) (default 1 atm)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ti&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;temperature_interval&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TI&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Initial temp, final temp, step size (K)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;freq_scale_factor&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SCALE_FACTOR&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Frequency scaling factor. If not set, try to find a suitable value in database. &quot;</span>
                             <span class="s2">&quot;If not found, use 1.0&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--vmm&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mm_freq_scale_factor&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;MM_SCALE_FACTOR&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Additional frequency scaling factor used in ONIOM calculations&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--spc&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;spc&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SPC&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Indicates single point corrections (default False)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--boltz&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;boltz&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show Boltzmann factors&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cpu&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cputime&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total CPU time&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--d3&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;D3&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Zero-damped DFTD3 correction will be computed&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--d3bj&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;D3BJ&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Becke-Johnson damped DFTD3 correction will be computed&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--atm&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ATM&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Axilrod-Teller-Muto 3-body dispersion correction will be computed&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--xyz&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Write Cartesians to a .xyz file (default False)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--csv&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Write .csv output file format&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--imag&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;imag_freq&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print imaginary frequencies (default False)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--invertifreq&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Make low lying imaginary frequencies positive (cutoff &gt; -50.0 wavenumbers)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--freespace&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;freespace&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FREESPACE&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Solvent (H2O, toluene, DMF, AcOH, chloroform) (default none)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dup&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;duplicate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove possible duplicates from thermochemical analysis&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cosmo&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cosmo&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;COSMO-RS&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Filename of a COSMO-RS .tab output file&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cosmo_int&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cosmo_int&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;COSMO-RS&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Filename of a COSMO-RS .tab output file along with a temperature range (K): &quot;</span>
                             <span class="s2">&quot;file.tab,&#39;Initial_T, Final_T&#39;&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--output&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;OUTPUT&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Change the default name of the output file to GoodVibes_</span><span class="se">\&quot;</span><span class="s2">output</span><span class="se">\&quot;</span><span class="s2">.dat&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pes&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pes&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PES&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tabulate relative values&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--nogconf&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;gconf&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Calculate a free-energy correction related to multi-configurational space (default &quot;</span>
                             <span class="s2">&quot;calculate Gconf)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ee&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ee&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tabulate selectivity values (excess, ratio) from a mixture, provide pattern for two &quot;</span>
                             <span class="s2">&quot;types such as *_R*,*_S*&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--check&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Checks if calculations were done with the same program, level of theory and solvent, &quot;</span>
                             <span class="s2">&quot;as well as detects potential duplicates&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--media&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;media&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;MEDIA&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Entropy correction for standard concentration of solvents&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--custom_ext&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List of additional file extensions to support, beyond .log or .out, use separated by &quot;</span>
                             <span class="s2">&quot;commas (ie, &#39;.qfi, .gaussian&#39;). It can also be specified with environment variable &quot;</span>
                             <span class="s2">&quot;GOODVIBES_CUSTOM_EXT&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--graph&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Graph a reaction profile based on free energies calculated. &quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ssymm&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;ssymm&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Turn on the symmetry correction.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--bav&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inertia&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;global&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">,</span><span class="s1">&#39;conf&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Choice of how the moment of inertia is computed. Options = &#39;global&#39; or &#39;conf&#39;.&quot;</span>
                            <span class="s2">&quot;&#39;global&#39; will use the same moment of inertia for all input molecules of 10*10-44,&quot;</span>
                            <span class="s2">&quot;&#39;conf&#39; will compute moment of inertia from parsed rotational constants from each Gaussian output file.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse Arguments</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="c1"># If requested, turn on head-gordon enthalpy correction</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">Q</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
        <span class="n">stars</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">142</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stars</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">128</span>
    <span class="c1"># If necessary, create an xyz file for Cartesians</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">xyz</span><span class="p">:</span> <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz_out</span><span class="p">(</span><span class="s2">&quot;Goodvibes&quot;</span><span class="p">,</span> <span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">)</span>
    <span class="c1"># If user has specified different file extensions</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">custom_ext</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GOODVIBES_CUSTOM_EXT&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">custom_extensions</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">custom_ext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GOODVIBES_CUSTOM_EXT&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">custom_extensions</span><span class="p">:</span>
            <span class="n">SUPPORTED_EXTENSIONS</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Default value for inverting imaginary frequencies</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">invert</span> <span class="o">==</span> <span class="o">-</span><span class="mf">50.0</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">invert</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span>

    <span class="c1"># Start a log for the results</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="s2">&quot;Goodvibes&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">csv</span><span class="p">)</span>
    <span class="c1"># Initialize the total CPU time</span>
    <span class="n">total_cpu_time</span><span class="p">,</span> <span class="n">add_days</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">00</span><span class="p">,</span> <span class="mi">00</span><span class="p">,</span> <span class="mi">00</span><span class="p">,</span> <span class="mi">00</span><span class="p">),</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="s1">&#39;clust:&#39;</span><span class="p">:</span>
                <span class="n">clustering</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">nclust</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c1"># Get the filenames from the command line prompt</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="s1">&#39;clust:&#39;</span><span class="p">:</span>
                <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">nclust</span> <span class="o">+=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">elem</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">SUPPORTED_EXTENSIONS</span><span class="p">:</span>  <span class="c1"># Look for file names</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="s1">&#39;link&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
                            <span class="n">clusters</span><span class="p">[</span><span class="n">nclust</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
                                <span class="n">clusters</span><span class="p">[</span><span class="n">nclust</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                                    <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">!=</span> <span class="s1">&#39;link&#39;</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error! SPC calculation file &#39;</span><span class="si">{}</span><span class="s2">&#39; not found! Make sure files are named with &quot;</span>
                                         <span class="s2">&quot;the convention: &#39;filename_spc&#39; or specify link job.</span><span class="se">\n</span><span class="s2">For help, use option &#39;-h&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                         <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">elem</span> <span class="o">!=</span> <span class="s1">&#39;clust:&#39;</span><span class="p">:</span>  <span class="c1"># Look for requested options</span>
                <span class="n">command</span> <span class="o">+=</span> <span class="n">elem</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># Start printing results</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   GoodVibes v&quot;</span> <span class="o">+</span> <span class="n">__version__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">goodvibes_ref</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Check if user has specified any files, if not quit now</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please provide GoodVibes with calculation output files on the command line.</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="s2">&quot;For help, use option &#39;-h&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="s1">&#39;(clustering active)&#39;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Temperature = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Kelvin&quot;</span><span class="p">)</span>
    <span class="c1"># If not at standard temp, need to correct the molarity of 1 atmosphere (assuming pressure is still 1 atm)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">:</span>
        <span class="n">gas_phase</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Concentration = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">conc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; mol/L&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gas_phase</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">options</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">ATMOS</span> <span class="o">/</span> <span class="p">(</span><span class="n">GAS_CONSTANT</span> <span class="o">*</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Pressure = 1 atm&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   All energetic values below shown in Hartree unless otherwise specified.&#39;</span><span class="p">)</span>
    <span class="c1"># Initial read of files, </span>
    <span class="c1"># Grab level of theory, solvation model, check for Normal Termination</span>
    <span class="n">l_o_t</span><span class="p">,</span> <span class="n">s_m</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">spc_progress</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">lot_sm_prog</span> <span class="o">=</span> <span class="n">read_initial</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">l_o_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">s_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">progress</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">orientation</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">grid</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1">#check spc files for normal termination</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">!=</span> <span class="s1">&#39;link&#39;</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span> 
                <span class="n">spc_file</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">):</span>
                <span class="n">spc_file</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span>
            <span class="n">lot_sm_prog</span> <span class="o">=</span> <span class="n">read_initial</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)</span>
            <span class="n">spc_progress</span><span class="p">[</span><span class="n">spc_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">lot_sm_prog</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">remove_key</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Remove problem files and print errors</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">x  Warning! Error termination found in file </span><span class="si">{}</span><span class="s2">. This file will be omitted from further &quot;</span>
                      <span class="s2">&quot;calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">remove_key</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">progress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Incomplete&#39;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">x  Warning! File </span><span class="si">{}</span><span class="s2"> may not have terminated normally or the calculation may still be &quot;</span>
                      <span class="s2">&quot;running. This file will be omitted from further calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">remove_key</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
    <span class="c1">#check spc files for normal termination</span>
    <span class="k">if</span> <span class="n">spc_progress</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">spc_progress</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spc_progress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">x  ERROR! Error termination found in file </span><span class="si">{}</span><span class="s2"> calculations.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">spc_progress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Incomplete&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">x  ERROR! File </span><span class="si">{}</span><span class="s2"> may not have terminated normally or the &quot;</span>
                    <span class="s2">&quot;calculation may still be running.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                          
    <span class="k">for</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">remove_key</span><span class="p">)):</span>
        <span class="n">files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">l_o_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">s_m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">orientation</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">grid</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Please try again with normally terminated output files.</span><span class="se">\n</span><span class="s2">For help, use option &#39;-h&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Attempt to automatically obtain frequency scale factor,</span>
    <span class="c1"># Application of freq scale factors requires all outputs to be same level of theory </span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;ONIOM&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   User-defined vibrational scale factor &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span>
                      <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; level of theory&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   User-defined vibrational scale factor &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">)</span> <span class="o">+</span>
                      <span class="s2">&quot; for QM region of &quot;</span> <span class="o">+</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Look for vibrational scaling factor automatically</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">):</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">scaling_data_dict</span><span class="p">,</span> <span class="n">scaling_data_dict_mod</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="o">.</span><span class="n">zpe_fac</span>
                    <span class="n">ref</span> <span class="o">=</span> <span class="n">scaling_refs</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="o">.</span><span class="n">zpe_ref</span><span class="p">]</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">o  Found vibrational scaling factor of </span><span class="si">{:.3f}</span><span class="s2"> for </span><span class="si">{}</span><span class="s2"> level of theory</span><span class="se">\n</span><span class="s2">&quot;</span>
                              <span class="s2">&quot;   REF: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="p">))</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Print files and different levels of theory found</span>
            <span class="n">files_l_o_t</span><span class="p">,</span> <span class="n">levels_l_o_t</span><span class="p">,</span> <span class="n">filtered_calcs_l_o_t</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">files_l_o_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l_o_t</span><span class="p">:</span>
                <span class="n">levels_l_o_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">filtered_calcs_l_o_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files_l_o_t</span><span class="p">)</span>
            <span class="n">filtered_calcs_l_o_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levels_l_o_t</span><span class="p">)</span>
            <span class="n">print_check_fails</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">filtered_calcs_l_o_t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">filtered_calcs_l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;levels of theory&quot;</span><span class="p">)</span>

    <span class="c1"># Exit program if a comparison of Boltzmann factors is requested and level of theory is not uniform across all files</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">ee</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">ERROR: When comparing files using Boltzmann factors (boltz or ee input options), the level of &quot;</span>
                 <span class="s2">&quot;theory used should be the same for all files.</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
    <span class="c1"># Exit program if molecular mechanics scaling factor is given and all files are not ONIOM calculations</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;ONIOM&#39;</span> <span class="ow">in</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   User-defined vibrational scale factor &quot;</span> <span class="o">+</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">mm_freq_scale_factor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; for MM region of &quot;</span> <span class="o">+</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oniom_scale_ref</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Option --vmm is only for use in ONIOM calculation output files.</span><span class="se">\n</span><span class="s2">   &quot;</span>
                     <span class="s2">&quot; help use option &#39;-h&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># If no scaling factor is found use 1.0</span>
        <span class="k">if</span> <span class="n">all_same</span><span class="p">(</span><span class="n">l_o_t</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Using vibrational scale factor </span><span class="si">{}</span><span class="s2"> for </span><span class="si">{}</span><span class="s2"> level of &quot;</span>
                      <span class="s2">&quot;theory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">l_o_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Using vibrational scale factor </span><span class="si">{}</span><span class="s2">: differing levels of theory &quot;</span>
                      <span class="s2">&quot;detected.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">))</span>
    <span class="c1"># Checks to see whether the available free space of a requested solvent is defined</span>
    <span class="n">freespace</span> <span class="o">=</span> <span class="n">get_free_space</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">freespace</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freespace</span> <span class="o">!=</span> <span class="mf">1000.0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Specified solvent &quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">freespace</span> <span class="o">+</span> <span class="s2">&quot;: free volume &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freespace</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; (mol/l) corrects the translational entropy&quot;</span><span class="p">)</span>

    <span class="c1"># Check for implicit solvation</span>
    <span class="n">printed_solv_warn</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s_m</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;smd&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;cpcm&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">printed_solv_warn</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Caution! Implicit solvation (SMD/CPCM) detected. Enthalpic and entropic terms cannot be &quot;</span>
                      <span class="s2">&quot;safely separated. Use them at your own risk!&quot;</span><span class="p">)</span>
            <span class="n">printed_solv_warn</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># COSMO-RS temperature interval</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">cfile</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cinterval</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   Reading COSMO-RS file: &#39;</span> <span class="o">+</span> <span class="n">cfile</span> <span class="o">+</span> <span class="s1">&#39; over a T range of &#39;</span> <span class="o">+</span> <span class="n">cinterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                  <span class="n">cinterval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; K.&#39;</span><span class="p">)</span>

        <span class="n">t_interval</span><span class="p">,</span> <span class="n">gsolv_dicts</span> <span class="o">=</span> <span class="n">cosmo_rs_out</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">cinterval</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># Read from COSMO-RS output</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cosmo_solv</span> <span class="o">=</span> <span class="n">cosmo_rs_out</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   Reading COSMO-RS file: &#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">cosmo_solv</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   Warning! COSMO-RS file &#39;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span> <span class="o">+</span> <span class="s1">&#39; requested but not found&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_cutoff</span> <span class="o">!=</span> <span class="mf">100.0</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">S_freq_cutoff</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_cutoff</span>
        <span class="n">options</span><span class="o">.</span><span class="n">H_freq_cutoff</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_cutoff</span>

    <span class="c1"># Summary of the quasi-harmonic treatment; print out the relevant reference</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Entropic quasi-harmonic treatment: frequency cut-off value of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">options</span><span class="o">.</span><span class="n">S_freq_cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; wavenumbers will be applied.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QS</span> <span class="o">==</span> <span class="s2">&quot;grimme&quot;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   QS = Grimme: Using a mixture of RRHO and Free-rotor vibrational entropies.&quot;</span><span class="p">)</span>
        <span class="n">qs_ref</span> <span class="o">=</span> <span class="n">grimme_ref</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QS</span> <span class="o">==</span> <span class="s2">&quot;truhlar&quot;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   QS = Truhlar: Using an RRHO treatment where low frequencies are adjusted to the cut-off value.&quot;</span><span class="p">)</span>
        <span class="n">qs_ref</span> <span class="o">=</span> <span class="n">truhlar_ref</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   FATAL ERROR: Unknown quasi-harmonic model &quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">QS</span> <span class="o">+</span> <span class="s2">&quot; specified (QS must = grimme or truhlar).&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">qs_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Check if qh-H correction should be applied</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Enthalpy quasi-harmonic treatment: frequency cut-off value of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">options</span><span class="o">.</span><span class="n">H_freq_cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; wavenumbers will be applied.&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   QH = Head-Gordon: Using an RRHO treatement with an approximation term for vibrational energy.&quot;</span><span class="p">)</span>
        <span class="n">qh_ref</span> <span class="o">=</span> <span class="n">head_gordon_ref</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">qh_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Check if D3 corrections should be applied</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">D3</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   D3-Dispersion energy with zero-damping will be calculated and included in the energy and enthalpy terms.&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">d3_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">D3BJ</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   D3-Dispersion energy with Becke-Johnson damping will be calculated and added to the energy terms.&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">d3bj_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ATM</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   The repulsive Axilrod-Teller-Muto 3-body term will be included in the dispersion correction.&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">atm_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Check if entropy symmetry correction should be applied</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   Ssymm requested. Symmetry contribution to entropy to be calculated using S. Patchkovskii</span><span class="se">\&#39;</span><span class="s1">s </span><span class="se">\n</span><span class="s1">   open source software &quot;Brute Force Symmetry Analyzer&quot; available under GNU General Public License.&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   REF: (C) 1996, 2003 S. Patchkovskii, Serguei.Patchkovskii@sympatico.ca&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   Atomic radii used to calculate internal symmetry based on Cambridge Structural Database covalent radii.&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   REF: &quot;</span> <span class="o">+</span> <span class="n">csd_ref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Whether single-point energies are to be used</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Combining final single point energy with thermal corrections.&quot;</span><span class="p">)</span>
    <span class="c1"># Solvent correction message</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Applying standard concentration correction (based on density at 20C) to solvent media.&quot;</span><span class="p">)</span>

    <span class="c1"># Check for special options </span>
    <span class="n">inverted_freqs</span><span class="p">,</span> <span class="n">inverted_files</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span><span class="p">:</span>
        <span class="n">ssymm_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ssymm_option</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">mm_freq_scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">vmm_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">mm_freq_scale_factor</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmm_option</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Loop over all specified output files and compute thermochemistry</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
            <span class="n">cosmo_option</span> <span class="o">=</span> <span class="n">cosmo_solv</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cosmo_option</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># computes D3 term if requested, which is then sent to calc bbe as a correction</span>
        <span class="n">d3_energy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">D3</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">D3BJ</span><span class="p">:</span>
            <span class="n">verbose</span><span class="p">,</span> <span class="n">intermolecular</span><span class="p">,</span> <span class="n">pairwise</span><span class="p">,</span> <span class="n">abc_term</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">s6</span><span class="p">,</span> <span class="n">rs6</span><span class="p">,</span> <span class="n">s8</span><span class="p">,</span> <span class="n">bj_a1</span><span class="p">,</span> <span class="n">bj_a2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="n">functional</span> <span class="o">=</span> <span class="n">level_of_theory</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">D3</span><span class="p">:</span>
                <span class="n">damp</span> <span class="o">=</span> <span class="s1">&#39;zero&#39;</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">D3BJ</span><span class="p">:</span>
                <span class="n">damp</span> <span class="o">=</span> <span class="s1">&#39;bj&#39;</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ATM</span><span class="p">:</span> <span class="n">abc_term</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fileData</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">d3_calc</span> <span class="o">=</span> <span class="n">D3</span><span class="o">.</span><span class="n">calcD3</span><span class="p">(</span><span class="n">fileData</span><span class="p">,</span> <span class="n">functional</span><span class="p">,</span> <span class="n">s6</span><span class="p">,</span> <span class="n">rs6</span><span class="p">,</span> <span class="n">s8</span><span class="p">,</span> <span class="n">bj_a1</span><span class="p">,</span> <span class="n">bj_a2</span><span class="p">,</span> <span class="n">damp</span><span class="p">,</span> <span class="n">abc_term</span><span class="p">,</span> <span class="n">intermolecular</span><span class="p">,</span>
                                    <span class="n">pairwise</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                <span class="n">d3_energy</span> <span class="o">=</span> <span class="p">(</span><span class="n">d3_calc</span><span class="o">.</span><span class="n">attractive_r6_vdw</span> <span class="o">+</span> <span class="n">d3_calc</span><span class="o">.</span><span class="n">attractive_r8_vdw</span> <span class="o">+</span> <span class="n">d3_calc</span><span class="o">.</span><span class="n">repulsive_abc</span><span class="p">)</span> <span class="o">/</span> <span class="n">KCAL_TO_AU</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   ! Dispersion Correction Failed&#39;</span><span class="p">)</span>
                <span class="n">d3_energy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">conc</span>
        <span class="c1">#check if media correction should be applied</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.media</span> <span class="kn">import</span> <span class="n">solvents</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">media</span> <span class="kn">import</span> <span class="n">solvents</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">solvents</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> \
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">mweight</span> <span class="o">=</span> <span class="n">solvents</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">density</span> <span class="o">=</span> <span class="n">solvents</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">conc</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="n">mweight</span>
                <span class="n">media_conc</span> <span class="o">=</span> <span class="n">conc</span>
        <span class="n">bbe</span> <span class="o">=</span> <span class="n">calc_bbe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QS</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">S_freq_cutoff</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">H_freq_cutoff</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                       <span class="n">conc</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">freespace</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span><span class="p">,</span>
                       <span class="n">d3_energy</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo_option</span><span class="p">,</span> <span class="n">ssymm</span><span class="o">=</span><span class="n">ssymm_option</span><span class="p">,</span> <span class="n">mm_freq_scale_factor</span><span class="o">=</span><span class="n">vmm_option</span><span class="p">,</span><span class="n">inertia</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">inertia</span><span class="p">)</span>

        <span class="c1"># Populate bbe_vals with indivual bbe entries for each file</span>
        <span class="n">bbe_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbe</span><span class="p">)</span>

    <span class="c1"># Creates a new dictionary object thermo_data, which attaches the bbe data to each file-name</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
    <span class="n">thermo_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">bbe_vals</span><span class="p">))</span>  <span class="c1"># The collected thermochemical data for all files</span>
    <span class="n">interval_bbe_data</span><span class="p">,</span> <span class="n">interval_thermo_data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">inverted_freqs</span><span class="p">,</span> <span class="n">inverted_files</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">inverted_freqs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inverted_freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">inverted_freqs</span><span class="p">)</span>
            <span class="n">inverted_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># Check if user has chosen to make any low lying imaginary frequencies positive</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inverted_files</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inverted_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   The following frequency was made positive and used in calculations: &quot;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">inverted_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">inverted_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   The following frequencies were made positive and used in calculations: &quot;</span> <span class="o">+</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">inverted_freqs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>

    <span class="c1"># Adjust printing according to options requested</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">stars</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">14</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">stars</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">30</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">imag_freq</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">stars</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">9</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">stars</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">7</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">stars</span> <span class="o">+=</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">13</span>

    <span class="c1"># Standard mode: tabulate thermochemistry ouput from file(s) at a single temperature and concentration</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                          <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;ZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">),</span>
                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;ZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
                                                                                           <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span>
                                                                                           <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                          <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;E_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;ZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                          <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;E_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;ZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;COSMO-RS&quot;</span><span class="p">,</span> <span class="s2">&quot;COSMO-qh-G(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Boltz&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">imag_freq</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;9}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;im freq&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Point Group&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Look for duplicates or enantiomers</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">duplicate</span><span class="p">:</span>
            <span class="n">dup_list</span> <span class="o">=</span> <span class="n">check_dup</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dup_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Boltzmann factors and averaging over clusters</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">weighted_free_energy</span><span class="p">,</span> <span class="n">boltz_sum</span> <span class="o">=</span> <span class="n">get_boltz</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">clustering</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span>
                                                                    <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dup_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>  <span class="c1"># Loop over the output files and compute thermochemistry</span>
            <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="n">dup_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">x  </span><span class="si">{}</span><span class="s1"> is a duplicate or enantiomer of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                                                                      <span class="n">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicate</span><span class="p">:</span>
                <span class="n">bbe</span> <span class="o">=</span> <span class="n">thermo_data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cputime</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># Add up CPU times</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">cpu</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">total_cpu_time</span> <span class="o">=</span> <span class="n">add_time</span><span class="p">(</span><span class="n">total_cpu_time</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;sp_cpu&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">sp_cpu</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">total_cpu_time</span> <span class="o">=</span> <span class="n">add_time</span><span class="p">(</span><span class="n">total_cpu_time</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">sp_cpu</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">total_cpu_time</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">add_days</span> <span class="o">+=</span> <span class="mi">31</span>

                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">xyz</span><span class="p">:</span>  <span class="c1"># Write Cartesians</span>
                    <span class="n">xyzdata</span> <span class="o">=</span> <span class="n">getoutData</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">xyz</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xyzdata</span><span class="o">.</span><span class="n">atom_types</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">):</span>
                        <span class="n">xyz</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Eopt&#39;</span><span class="p">,</span>
                                                            <span class="n">bbe</span><span class="o">.</span><span class="n">scf_energy</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xyz</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xyzdata</span><span class="p">,</span> <span class="s1">&#39;cartesians&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xyzdata</span><span class="p">,</span> <span class="s1">&#39;atom_types&#39;</span><span class="p">):</span>
                        <span class="n">xyz</span><span class="o">.</span><span class="n">write_coords</span><span class="p">(</span><span class="n">xyzdata</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">xyzdata</span><span class="o">.</span><span class="n">cartesians</span><span class="p">)</span>

                <span class="c1"># Check for possible error in Gaussian calculation of linear molecules which can return 2 rotational constants instead of 3</span>
                <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">linear_warning</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;          ----   Caution! Potential invalid calculation of linear molecule from Gaussian&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">!=</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  &quot;</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">sp_energy</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">bbe</span><span class="o">.</span><span class="n">sp_energy</span> <span class="o">==</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;----&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  &quot;</span><span class="p">)</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># Gaussian SPC file handling</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="c1"># ORCA spc files</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">scf_energy</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># No freqs found</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   Warning! Couldn&#39;t find frequency information ...&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span> <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span>
                               <span class="p">[</span><span class="s2">&quot;enthalpy&quot;</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span><span class="p">,</span> <span class="s2">&quot;qh_entropy&quot;</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">bbe</span><span class="o">.</span><span class="n">zpe</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_enthalpy</span><span class="p">,</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span>
                                    <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span> <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span>
                                    <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">zpe</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span>
                                                            <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span>
                                                            <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span>
                                                            <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">solvents</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> \
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Solvent: </span><span class="si">{:4.2f}</span><span class="s2">M &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media_conc</span><span class="p">))</span>
                        
                <span class="c1"># Append requested options to end of output</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span> <span class="ow">and</span> <span class="n">cosmo_solv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cosmo_solv</span><span class="p">[</span><span class="n">file</span><span class="p">],</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span> <span class="o">+</span> <span class="n">cosmo_solv</span><span class="p">[</span><span class="n">file</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">boltz</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:7.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boltz_facs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">/</span> <span class="n">boltz_sum</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">imag_freq</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;im_frequency_wn&quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">bbe</span><span class="o">.</span><span class="n">im_frequency_wn</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:9.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ssymm</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">point_group</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;37}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">))</span>
            <span class="c1"># Cluster files if requested</span>
            <span class="k">if</span> <span class="n">clustering</span><span class="p">:</span>
                <span class="n">dashes</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
                    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">structure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">structure</span> <span class="o">==</span> <span class="n">file</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="n">dashes</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;{name:&lt;</span><span class="si">{var_width}</span><span class="s1">} </span><span class="si">{gval:13.6f}</span><span class="s1"> </span><span class="si">{weight:6.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Boltzmann-weighted Cluster &#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">var_width</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span>
                                    <span class="n">gval</span><span class="o">=</span><span class="n">weighted_free_energy</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">/</span> <span class="n">boltz_facs</span><span class="p">[</span>
                                        <span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span>
                                    <span class="n">weight</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">boltz_facs</span><span class="p">[</span><span class="s1">&#39;cluster-&#39;</span> <span class="o">+</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">/</span> <span class="n">boltz_sum</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="n">dashes</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Perform checks for consistent options provided in calculation files (level of theory)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
        <span class="n">check_files</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">stars</span><span class="p">,</span> <span class="n">l_o_t</span><span class="p">,</span> <span class="n">s_m</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

    <span class="c1"># Running a variable temperature analysis of the enthalpy, entropy and the free energy</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Variable-Temperature analysis of the enthalpy, entropy and the entropy at a constant pressure between&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">temperature_interval</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
            <span class="c1"># If no temperature step was defined, divide the region into 10</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temperature_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">temperature_interval</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">temperature_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temperature_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">temperature_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">temperature_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                             <span class="nb">int</span><span class="p">(</span><span class="n">temperature_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   T init:  </span><span class="si">%.1f</span><span class="s2">,  T final:  </span><span class="si">%.1f</span><span class="s2">,  T interval: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">temperature_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temperature_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">temperature_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">t_interval</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   T init:  </span><span class="si">%.1f</span><span class="s2">,   T final: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
            <span class="n">qh_print_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   </span><span class="si">{:&lt;39}</span><span class="s2"> </span><span class="si">{:&gt;13}</span><span class="s2"> </span><span class="si">{:&gt;24}</span><span class="s2"> </span><span class="si">{:&gt;13}</span><span class="s2"> </span><span class="si">{:&gt;10}</span><span class="s2"> </span><span class="si">{:&gt;10}</span><span class="s2"> </span><span class="si">{:&gt;13}</span><span class="s2"> </span><span class="si">{:&gt;13}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qh_print_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;COSMO-RS-qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qh_print_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;COSMO-RS-qh-G(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qh_print_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qh_print_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-H&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_format_3</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   </span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;24}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">print_format_3</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;COSMO-RS-qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">print_format_3</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;COSMO-RS-qh-G(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">print_format_3</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)_SPC&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;qh-G(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">print_format_3</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Structure&quot;</span><span class="p">,</span> <span class="s2">&quot;Temp/K&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T.S&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-S&quot;</span><span class="p">,</span> <span class="s2">&quot;G(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-G(T)&quot;</span><span class="p">),</span>
                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>  <span class="c1"># Temperature interval</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span><span class="p">)</span>
            <span class="n">interval_bbe_data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval</span><span class="p">)):</span>  <span class="c1"># Iterate through the temperature range</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">gas_phase</span><span class="p">:</span>
                    <span class="n">conc</span> <span class="o">=</span> <span class="n">ATMOS</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">conc</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">conc</span>
                <span class="n">linear_warning</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">cosmo_option</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cosmo_option</span> <span class="o">=</span> <span class="n">gsolv_dicts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">file</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># haven&#39;t implemented D3 for this option</span>
                    <span class="n">bbe</span> <span class="o">=</span> <span class="n">calc_bbe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QS</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">S_freq_cutoff</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">H_freq_cutoff</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span>
                                   <span class="n">conc</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">freq_scale_factor</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">freespace</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">invert</span><span class="p">,</span>
                                   <span class="mf">0.0</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo_option</span><span class="p">,</span><span class="n">inertia</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">inertia</span><span class="p">)</span>
                <span class="n">interval_bbe_data</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbe</span><span class="p">)</span>
                <span class="n">linear_warning</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">linear_warning</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">linear_warning</span> <span class="o">==</span> <span class="p">[[</span><span class="s1">&#39;Warning! Potential invalid calculation of linear molecule from Gaussian.&#39;</span><span class="p">]]:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;             Warning! Potential invalid calculation of linear molecule from Gaussian ...&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Gaussian spc files</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="c1"># ORCA spc files</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;scf_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning! Couldn&#39;t find frequency information ...&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  &quot;</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span><span class="p">),</span>
                                  <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="c1"># if not options.media:</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bbe</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span> <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span>
                               <span class="p">[</span><span class="s2">&quot;enthalpy&quot;</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span><span class="p">,</span> <span class="s2">&quot;qh_entropy&quot;</span><span class="p">,</span> <span class="s2">&quot;gibbs_free_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:24.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_enthalpy</span><span class="p">,</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span> <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">cosmo_qhg</span><span class="p">),</span>
                                        <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:24.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_enthalpy</span><span class="p">,</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span> <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">),</span>
                                        <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:24.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span> <span class="p">(</span>
                                            <span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span> <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span>
                                                                                                     <span class="n">bbe</span><span class="o">.</span><span class="n">cosmo_qhg</span><span class="p">),</span>
                                              <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{:24.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:10.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1"> </span><span class="si">{:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bbe</span><span class="o">.</span><span class="n">enthalpy</span><span class="p">,</span> <span class="p">(</span>
                                            <span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">entropy</span><span class="p">),</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_entropy</span><span class="p">),</span> <span class="n">bbe</span><span class="o">.</span><span class="n">gibbs_free_energy</span><span class="p">,</span> <span class="n">bbe</span><span class="o">.</span><span class="n">qh_gibbs_free_energy</span><span class="p">),</span>
                                              <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">solvents</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> \
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Solvent: </span><span class="si">{:4.2f}</span><span class="s2">M &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media_conc</span><span class="p">))</span>
                            
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Print CPU usage if requested</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cputime</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">{:&lt;13}</span><span class="s1"> </span><span class="si">{:&gt;2}</span><span class="s1"> </span><span class="si">{:&gt;4}</span><span class="s1"> </span><span class="si">{:&gt;2}</span><span class="s1"> </span><span class="si">{:&gt;3}</span><span class="s1"> </span><span class="si">{:&gt;2}</span><span class="s1"> </span><span class="si">{:&gt;4}</span><span class="s1"> </span><span class="si">{:&gt;2}</span><span class="s1"> &#39;</span>
                  <span class="s1">&#39;</span><span class="si">{:&gt;4}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TOTAL CPU&#39;</span><span class="p">,</span> <span class="n">total_cpu_time</span><span class="o">.</span><span class="n">day</span> <span class="o">+</span> <span class="n">add_days</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="n">total_cpu_time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="s1">&#39;hrs&#39;</span><span class="p">,</span>
                                   <span class="n">total_cpu_time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="s1">&#39;mins&#39;</span><span class="p">,</span> <span class="n">total_cpu_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="s1">&#39;secs&#39;</span><span class="p">))</span>

    <span class="c1"># Tabulate relative values</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   Gconf correction requested to be applied to below relative values using quasi-harmonic Boltzmann factors</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">):</span>
                <span class="n">pes_error</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning! Could not find thermodynamic data for &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">pes_error</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pes_error</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning! Could not find thermodynamic data for &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">pes_error</span><span class="p">)</span>
        <span class="c1"># Interval applied to PES</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature_interval</span><span class="p">:</span>
            <span class="n">stars</span> <span class="o">=</span> <span class="n">stars</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">22</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval</span><span class="p">)):</span>
                <span class="n">bbe_vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_bbe_data</span><span class="p">)):</span>
                    <span class="n">bbe_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interval_bbe_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">interval_thermo_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">bbe_vals</span><span class="p">)))</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interval</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">pes</span> <span class="o">=</span> <span class="n">get_pes</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pes</span><span class="p">,</span> <span class="n">interval_thermo_data</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">log</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pes</span> <span class="o">=</span> <span class="n">get_pes</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pes</span><span class="p">,</span> <span class="n">interval_thermo_data</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">log</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">,</span>
                                  <span class="n">cosmo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                        <span class="n">zero_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">pes</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">pes</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">zero_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">pes</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                        <span class="n">zero_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span><span class="p">:</span>
                        <span class="n">e_sum</span><span class="p">,</span> <span class="n">h_sum</span><span class="p">,</span> <span class="n">g_sum</span><span class="p">,</span> <span class="n">qhg_sum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                        <span class="n">sels</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                                <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                           <span class="n">pes</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                           <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                           <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                           <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]]</span>
                            <span class="n">relative</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">zero_vals</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zero_vals</span><span class="p">))]</span>
                            <span class="n">e_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temp</span><span class="p">)</span>
                            <span class="n">h_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temp</span><span class="p">)</span>
                            <span class="n">g_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temp</span><span class="p">)</span>
                            <span class="n">qhg_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">temp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;40}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;RXN: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s2">&quot;)  at T: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">,</span> <span class="s1">&#39;COSMO-qh-G(T)&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">,</span>
                                                      <span class="s1">&#39;COSMO-qh-G(T)&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">),</span>
                                      <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;40}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;RXN: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s2">&quot;)  at T: &quot;</span> <span class="o">+</span>
                                                            <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s1">&#39;COSMO-qh-G(T)_SPC&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s1">&#39;COSMO-qh-G(T)_SPC&#39;</span><span class="p">),</span>
                                      <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                       <span class="n">pes</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                       <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                       <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span>
                                       <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">])</span>
                        <span class="n">relative</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">zero_vals</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zero_vals</span><span class="p">))]</span>
                        <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">:</span>
                            <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">J_TO_AU</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">relative</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">KCAL_TO_AU</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">relative</span><span class="p">]</span>  <span class="c1"># Defaults to kcal/mol</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  &quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">formatted_list</span> <span class="o">=</span> <span class="n">formatted_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                            <span class="n">format_1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span> \
                                       <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span>
                            <span class="n">format_2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> &#39;</span> \
                                       <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span>
                            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> &#39;</span>
                                              <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                              <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo_int</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span><span class="p">:</span>
                            <span class="n">boltz</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">e_sum</span><span class="p">,</span>
                                     <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">h_sum</span><span class="p">,</span>
                                     <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">g_sum</span><span class="p">,</span>
                                     <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">qhg_sum</span><span class="p">]</span>
                            <span class="n">selectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">boltz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boltz</span><span class="p">))]</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">%</span><span class="si">{:24.2f}</span><span class="s1">%</span><span class="si">{:35.2f}</span><span class="s1">%</span><span class="si">{:13.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">selectivity</span><span class="p">))</span>
                            <span class="n">sels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selectivity</span><span class="p">)</span>
                        <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">formatted_list</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formatted_list</span><span class="p">))]</span>
                    <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span> <span class="o">==</span> <span class="s1">&#39;ee&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">ee</span> <span class="o">=</span> <span class="p">[</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">sels</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">%</span><span class="si">{:24.1f}</span><span class="s1">%</span><span class="si">{:35.1f}</span><span class="s1">%</span><span class="si">{:13.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ee (%)&#39;</span><span class="p">,</span>
                                                                                                              <span class="o">*</span><span class="n">ee</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:27.1f}</span><span class="s1"> </span><span class="si">{:24.1f}</span><span class="s1"> </span><span class="si">{:35.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ee (%)&#39;</span><span class="p">,</span>
                                                                                                              <span class="o">*</span><span class="n">ee</span><span class="p">))</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                <span class="n">pes</span> <span class="o">=</span> <span class="n">get_pes</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pes</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pes</span> <span class="o">=</span> <span class="n">get_pes</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pes</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">)</span>
            <span class="c1"># Output the relative energy data</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                    <span class="n">zero_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">pes</span><span class="o">.</span><span class="n">qh_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zero_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">ts_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhts_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">pes</span><span class="o">.</span><span class="n">g_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                    <span class="n">zero_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">cosmo_qhg_zero</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span><span class="p">:</span>
                    <span class="n">e_sum</span><span class="p">,</span> <span class="n">h_sum</span><span class="p">,</span> <span class="n">g_sum</span><span class="p">,</span> <span class="n">qhg_sum</span><span class="p">,</span> <span class="n">cosmo_qhg_sum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                    <span class="n">sels</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                       <span class="n">pes</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                       <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                       <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                       <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">relative</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">zero_vals</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zero_vals</span><span class="p">))]</span>
                        <span class="n">e_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                        <span class="n">h_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                        <span class="n">g_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                        <span class="n">qhg_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                        <span class="n">cosmo_qhg_sum</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;40}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;RXN: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s2">&quot;) &quot;</span><span class="p">,</span> <span class="p">))</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">,</span>
                                                  <span class="s1">&#39;COSMO-qh-G(T)&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">),</span>
                                  <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">,</span>
                                                  <span class="s1">&#39;COSMO-qh-G(T)&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)&quot;</span><span class="p">),</span>
                                  <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;40}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;RXN: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s2">&quot;) &quot;</span><span class="p">,</span> <span class="p">))</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s1">&#39;COSMO-qh-G(T)_SPC&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">,</span> <span class="s1">&#39;COSMO-qh-G(T)_SPC&#39;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;10}</span><span class="s1"> </span><span class="si">{:&gt;14}</span><span class="s1"> &#39;</span>
                                  <span class="s1">&#39;</span><span class="si">{:&gt;14}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; DE_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DZPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DH_SPC&quot;</span><span class="p">,</span> <span class="s2">&quot;T.DS&quot;</span><span class="p">,</span> <span class="s2">&quot;T.qh-DS&quot;</span><span class="p">,</span> <span class="s2">&quot;DG(T)_SPC&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;qh-DG(T)_SPC&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e_abs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">:</span>
                        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                   <span class="n">pes</span><span class="o">.</span><span class="n">qh_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                   <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">pes</span><span class="o">.</span><span class="n">spc_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">e_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">zpe_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">h_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                   <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">s_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">pes</span><span class="o">.</span><span class="n">qs_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                   <span class="n">pes</span><span class="o">.</span><span class="n">g_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">pes</span><span class="o">.</span><span class="n">qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                        <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">cosmo_qhg_abs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">relative</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">zero_vals</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zero_vals</span><span class="p">))]</span>
                    <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">:</span>
                        <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">J_TO_AU</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">relative</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">KCAL_TO_AU</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">relative</span><span class="p">]</span>  <span class="c1"># Defaults to kcal/mol</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">o  &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">formatted_list</span> <span class="o">=</span> <span class="n">formatted_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">cosmo</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span>
                                          <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:10.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">dec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:10.2f}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> &#39;</span>
                                          <span class="s1">&#39;</span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pes</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="o">*</span><span class="n">formatted_list</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span><span class="p">:</span>
                        <span class="n">boltz</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">e_sum</span><span class="p">,</span>
                                 <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">h_sum</span><span class="p">,</span>
                                 <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">g_sum</span><span class="p">,</span>
                                 <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">J_TO_AU</span> <span class="o">/</span> <span class="n">GAS_CONSTANT</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">/</span> <span class="n">qhg_sum</span><span class="p">]</span>
                        <span class="n">selectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">boltz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boltz</span><span class="p">))]</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">%</span><span class="si">{:24.2f}</span><span class="s1">%</span><span class="si">{:35.2f}</span><span class="s1">%</span><span class="si">{:13.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">selectivity</span><span class="p">))</span>
                        <span class="n">sels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selectivity</span><span class="p">)</span>
                    <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">formatted_list</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formatted_list</span><span class="p">))]</span>
                <span class="k">if</span> <span class="n">pes</span><span class="o">.</span><span class="n">boltz</span> <span class="o">==</span> <span class="s1">&#39;ee&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ee</span> <span class="o">=</span> <span class="p">[</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">sels</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1">%</span><span class="si">{:24.1f}</span><span class="s1">%</span><span class="si">{:35.1f}</span><span class="s1">%</span><span class="si">{:13.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ee (%)&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">ee</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:27.1f}</span><span class="s1"> </span><span class="si">{:24.1f}</span><span class="s1"> </span><span class="si">{:35.1f}</span><span class="s1"> </span><span class="si">{:13.1f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ee (%)&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">ee</span><span class="p">))</span>
                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Compute enantiomeric excess</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">ee</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">selec_stars</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">109</span>
        <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">weighted_free_energy</span><span class="p">,</span> <span class="n">boltz_sum</span> <span class="o">=</span> <span class="n">get_boltz</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">clustering</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span>
                                                                <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dup_list</span><span class="p">)</span>
        <span class="n">ee</span><span class="p">,</span> <span class="n">er</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">dd_free_energy</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">preference</span> <span class="o">=</span> <span class="n">get_selectivity</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">ee</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">boltz_facs</span><span class="p">,</span> <span class="n">boltz_sum</span><span class="p">,</span>
                                                                            <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">dup_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">failed</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:&lt;39}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Selectivity&quot;</span><span class="p">,</span> <span class="s2">&quot;Excess (%)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ratio (%)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;Major Iso&quot;</span><span class="p">,</span> <span class="s2">&quot;ddG&quot;</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">selec_stars</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">o </span><span class="si">{:&lt;40}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:&gt;13}</span><span class="s1"> </span><span class="si">{:13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">er</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">preference</span><span class="p">,</span>
                                                                                 <span class="n">dd_free_energy</span><span class="p">),</span> <span class="n">thermodata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">selec_stars</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Graph reaction profiles</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">   Warning! matplotlib module is not installed, reaction profile will not be graphed.&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   To install matplotlib, run the following commands: </span><span class="se">\n\t</span><span class="s2">   python -m pip install -U pip&quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">   python -m pip install -U matplotlib</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thermo_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s2">&quot;qh_gibbs_free_energy&quot;</span><span class="p">):</span>
                <span class="n">pes_error</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning! Could not find thermodynamic data for &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">pes_error</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thermo_data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s2">&quot;sp_energy&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">spc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pes_error</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning! Could not find thermodynamic data for &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">pes_error</span><span class="p">)</span>

        <span class="n">graph_data</span> <span class="o">=</span> <span class="n">get_pes</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">gconf</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">QH</span><span class="p">)</span>
        <span class="n">graph_reaction_profile</span><span class="p">(</span><span class="n">graph_data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">plt</span><span class="p">)</span>

    <span class="c1"># Close the log</span>
    <span class="n">log</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">xyz</span><span class="p">:</span> <span class="n">xyz</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Luchini, G.; Alegre-Requena J. V.; Guan, Y.; Funes-Ardoiz, I.; Paton, R. S.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>